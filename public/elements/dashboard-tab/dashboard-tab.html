<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../global-loader/global-loader.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../dashboard-tiles/tile-linechart.html">
<link rel="import" href="../dashboard-tiles/tile-gaugechart.html">
<link rel="import" href="../dashboard-tiles/tile-slider.html">
<link rel="import" href="../dashboard-tiles/tile-kpi.html">
<link rel="import" href="../dashboard-tiles/tile-comparechart.html">
<link rel="import" href="../dashboard-tiles/tile-table.html">

<dom-module id="dashboard-tab">

    <template>


        <style>
            :host {
                display: block;
                min-height: 100%;
            }

            ::content .select-type input[type="radio"] {
                display: none;
            }

            ::content .select-type input[type="radio"]:not(:checked)+.select-type-box {
                cursor: pointer;
                border: 1px solid #dae0e5;
            }

            ::content .select-type input[type="radio"]:checked+.select-type-box {
                background-color: #dae0e5;
                border: 1px solid #0069d9;
                position: relative;
            }

            ::content .select-type input[type="radio"]:checked+.select-type-box::after {
                content: "\2713";
                width: 20px;
                height: 20px;
                line-height: 20px;
                border-radius: 100%;
                background-color: #0069d9;
                color: #ffffff;
                font-size: 11px;
                z-index: 999;
                position: absolute;
                top: 5px;
                right: 5px;
            }



            ::content .dashboard-tile {
                touch-action: none;
                user-select: none;
            }

            ::content .dashboard-tile:hover {
                box-shadow: inset 0 0 0 1px #6fb444;
                cursor: move !important;
            }


            @media (max-width: 990px) {
                ::content .dashboard-tile {
                    position: relative !important;
                    overflow: hidden !important;
                    width: 100% !important;
                    left: 0 !important;
                    top: 0 !important;
                    height: auto !important;
                }
            }

            ::content .dashboard-add-tile {
                position: fixed;
                bottom: 20px;
                right: 20px;
                opacity: .85;
                z-index: 96;
            }

            ::content .dashboard-add-tile-button {
                display: block;
                width: 64px;
                height: 64px;
                line-height: 0;
                font-size: 47px;
                text-align: center;
                padding: 28px 0 36px 0;
            }

            ::content .dashboard-add-tile-button:focus {
                outline: none;
            }

            ::content .tile-controls {
                position: absolute;
                top: -100%;
                right: 15px;
                z-index: 1;
                opacity: 0;
                transition: top 50ms;
            }

            ::content .dashboard-tile:hover .tile-controls,
            ::content .dashboard-tile:hover .tile-controls {
                top: 14px;
                opacity: 1;
            }

            ::content .dashboard-tile .tile-controls a {
                display: inline-block;
                border-radius: 50%;
                width: 28px;
                height: 28px;
                line-height: 28px;
                text-align: center;
                transition: box-shadow 200ms;
            }

            ::content .dashboard-tile .tile-controls a:hover {
                box-shadow: inset 0 0 0 1px rgba(0, 0, 0, .5);
            }

            ::content .btn-back {
                line-height: 10px;
                font-size: 30px;
                padding: 5px 10px 10px 7px;
            }

            ::content .modal-dialog-scrollable .modal-body {
                overflow-y: auto;
                max-height: calc(100vh - 250px);
            }

            ::content .label-required {
                color: #ab201d;
            }
        </style>




        <global-loader>
            <iron-ajax auto url="/getTagList" last-response="{{responseTagList}}" loading="{{getTagListLoading}}">
            </iron-ajax>
        </global-loader>

        <template is="dom-if" if="{{!getTagListLoading}}">

            <global-loader>
                <iron-ajax auto id="getMultiDashboardTiles" url$="/getMultiDashboardTiles/{{dashboardId}}"
                    on-response="_onResponse_getMultiDashboardTiles" loading="{{getMultiDashboardTilesLoading}}">
                </iron-ajax>
            </global-loader>

            <global-loader>
                <iron-ajax id="addMultiDashboardTile" method="POST" url="/addMultiDashboardTile"
                    headers='{"Content-Type": "application/json"}' on-response="_onResponse_addMultiDashboardTile">
                </iron-ajax>
            </global-loader>


            <global-loader>
                <iron-ajax id="updateMultiDashboardTile" method="POST" url="/updateMultiDashboardTile"
                    headers='{"Content-Type": "application/json"}' on-response="_onResponse_updateMultiDashboardTile">
                </iron-ajax>
            </global-loader>


            <global-loader>
                <iron-ajax id="deleteMultiDashboardTile" on-response="_onResponse_deleteMultiDashboardTile">
                </iron-ajax>
            </global-loader>

            <global-loader>
                <iron-ajax id="maintainTilesOrder" method="POST" url="/maintainTilesOrder"
                    headers='{"Content-Type": "application/json"}' on-response="_onResponse_maintainTilesOrder">
                </iron-ajax>
            </global-loader>
        </template>

        <template is="dom-if" if="{{!getTagListLoading}}" restamp>
            <div class="container-fuild">
                <template is="dom-repeat" items="{{getMultiDashboardTilesResponse}}">
                    <div class="dashboard-tile position-absolute" data-tile-id$="{{item.tile_id}}" style$="left: {{item.cords_config.left}}px; top: {{item.cords_config.top}}px; width: {{item.cords_config.width}}px; height: {{item.cords_config.height}}px;">

                        <div class="tile-controls">
                            <button data-toggle="modal" data-target$="#deleteGraph{{tabUid}}" data-backdrop="static"
                                data-keyboard="false" title="Delete tile" class="btn btn-sm" data-graph$="{{item}}"
                                on-click="_deleteDashboardTile"><i class="fas fa-trash text-danger"></i></button>

                            <button data-toggle="modal" data-target$="#editTile_{{tabUid}}" data-backdrop="static"
                                data-keyboard="false" title="Edit tile" class="btn btn-sm" data-graph$="{{item}}"
                                on-click="_editDashboardTile"><i class="fas fa-pen text-dark"></i></button>


                            <!-- <button title="Move tile" class="handle btn btn-sm"><i
                                    class="fas fa-arrows-alt text-dark"></i></button> -->

                        </div>


                        <template is="dom-if" if="{{_isEqual(item.tile_type, 'kpi')}}" restamp>
                            <tile-kpi class="tile" data-tile="{{item}}" data-tags="{{responseTagList}}"
                                data-tile-id$="{{item.tile_id}}" data-left$="{{item.cords_config.left}}" data-top$="{{item.cords_config.top}}" data-width$="{{item.cords_config.width}}" data-height$="{{item.cords_config.height}}" data-z$="{{item.sort_id}}"></tile-kpi>
                        </template>


                        <template is="dom-if" if="{{_isEqual(item.tile_type, 'lineChart')}}" restamp>
                            <tile-linechart class="tile" data-tile="{{item}}" data-tags="{{responseTagList}}"
                                data-tile-id$="{{item.tile_id}}" data-left$="{{item.cords_config.left}}" data-top$="{{item.cords_config.top}}" data-width$="{{item.cords_config.width}}" data-height$="{{item.cords_config.height}}" data-z$="{{item.sort_id}}">
                            </tile-linechart>
                        </template>

                        <template is="dom-if" if="{{_isEqual(item.tile_type, 'table')}}" restamp>
                            <tile-table class="tile" data-tile="{{item}}" data-tags="{{responseTagList}}"
                                data-tile-id$="{{item.tile_id}}" data-left$="{{item.cords_config.left}}" data-top$="{{item.cords_config.top}}" data-width$="{{item.cords_config.width}}" data-height$="{{item.cords_config.height}}" data-z$="{{item.sort_id}}"></tile-table>
                        </template>

                        <template is="dom-if" if="{{_isEqual(item.tile_type, 'gaugeChart')}}" restamp>
                            <tile-gaugechart class="tile" data-tile="{{item}}" data-tags="{{responseTagList}}"
                                data-tile-id$="{{item.tile_id}}" data-left$="{{item.cords_config.left}}" data-top$="{{item.cords_config.top}}" data-width$="{{item.cords_config.width}}" data-height$="{{item.cords_config.height}}" data-z$="{{item.sort_id}}">
                            </tile-gaugechart>
                        </template>

                        <template is="dom-if" if="{{_isEqual(item.tile_type, 'slider')}}" restamp>
                            <tile-slider class="tile" data-tile="{{item}}" data-tags="{{responseTagList}}"
                                data-tile-id$="{{item.tile_id}}" data-left$="{{item.cords_config.left}}" data-top$="{{item.cords_config.top}}" data-width$="{{item.cords_config.width}}" data-height$="{{item.cords_config.height}}" data-z$="{{item.sort_id}}">
                            </tile-slider>
                        </template>


                        <template is="dom-if" if="{{_isEqual(item.tile_type, 'compareChart')}}" restamp>
                            <tile-comparechart class="tile" data-tile="{{item}}" data-tags="{{responseTagList}}" data-tile-id$="{{item.tile_id}}" data-left$="{{item.cords_config.left}}" data-top$="{{item.cords_config.top}}" data-width$="{{item.cords_config.width}}" data-height$="{{item.cords_config.height}}" data-z$="{{item.sort_id}}">
                            </tile-comparechart>
                        </template>


                    </div>
                </template>

                <div class="dashboard-add-tile">
                    <button
                        class="dashboard-add-tile-button bg-info rounded-circle text-decoration-none text-white border-0"
                        data-toggle="modal" data-target$="#selectTileType{{tabUid}}" data-backdrop="static"
                        data-keyboard="false" title="Add new tile" on-click="_addNew">+</button>
                </div>
            </div>
        </template>





        <!-- Modal - selectTileType -->
        <div class="modal" id$="selectTileType{{tabUid}}" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Tile type <span class="label-required">&#8727;</span></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form id$="formSelectTileType{{tabUid}}">
                        <div class="modal-body">

                            <div class="d-flex pb-3 mx-n2">

                                <label class="select-type col p-0 px-2 m-0">
                                    <input type="radio" name="chartType" value="kpi" on-click="_typeSelected" required />
                                    <div class="select-type-box rounded p-4 text-center">
                                        <!-- <i class="fas fa-chart-bar fa-4x"></i> -->
                                        <svg class="mb-3" xmlns="http://www.w3.org/2000/svg" height="36" width="36"
                                            viewBox="0 0 32 32">
                                            <g id="Grid">
                                                <path
                                                    d="M12,0H2C0.895,0,0,0.895,0,2v10c0,1.104,0.895,2,2,2h10c1.105,0,2-0.896,2-2V2C14,0.895,13.105,0,12,0z    M12,12H2V2h10V12z"
                                                    fill="#121313" />
                                                <path
                                                    d="M30,0H20c-1.105,0-2,0.895-2,2v10c0,1.104,0.895,2,2,2h10c1.104,0,2-0.896,2-2V2C32,0.895,31.104,0,30,0z    M30,12H20V2h10V12z"
                                                    fill="#121313" />
                                                <path
                                                    d="M30,18H20c-1.105,0-2,0.896-2,2v10c0,1.105,0.895,2,2,2h10c1.104,0,2-0.895,2-2V20   C32,18.895,31.104,18,30,18z M30,30l-10,0V20h10V30z"
                                                    fill="#121313" />
                                                <path
                                                    d="M12,18H2c-1.105,0-2,0.896-2,2v10c0,1.105,0.895,2,2,2h10c1.105,0,2-0.895,2-2V20   C14,18.895,13.105,18,12,18z M12,30L2,30V20h10V30z"
                                                    fill="#121313" />
                                            </g>
                                        </svg>
                                        <div class="h6 m-0">KPI</div>
                                    </div>
                                </label>


                                <label class="select-type col p-0 px-2 m-0">
                                    <input type="radio" name="chartType" value="lineChart" on-click="_typeSelected"
                                        required />
                                    <div class="select-type-box rounded p-4 text-center">
                                        <!-- <i class="fas fa-chart-line fa-4x"></i> -->
                                        <svg class="mb-3" xmlns="http://www.w3.org/2000/svg" width="36" height="36"
                                            viewBox="0 0 24 24">
                                            <path
                                                d="M24 3.875l-6 1.221 1.716 1.708-5.351 5.358-3.001-3.002-7.336 7.242 1.41 1.418 5.922-5.834 2.991 2.993 6.781-6.762 1.667 1.66 1.201-6.002zm0 16.125v2h-24v-20h2v18h22z" />
                                        </svg>
                                        <div class="h6 m-0">Line chart</div>
                                    </div>
                                </label>

                                <label class="select-type col p-0 px-2 m-0">
                                    <input type="radio" name="chartType" value="compareChart" on-click="_typeSelected"
                                        required />
                                    <div class="select-type-box rounded p-4 text-center">
                                        <!-- <i class="fas fa-chart-bar fa-4x"></i> -->
                                        <svg class="mb-3" xmlns="http://www.w3.org/2000/svg" width="36" height="36"
                                            viewBox="0 0 24 24">
                                            <path
                                                d="M24 3.055l-6 1.221 1.716 1.708-5.351 5.358-3.001-3.002-7.336 7.242 1.41 1.418 5.922-5.834 2.991 2.993 6.781-6.762 1.667 1.66 1.201-6.002zm-16.69 6.477l-3.282-3.239 1.41-1.418 3.298 3.249-1.426 1.408zm15.49 3.287l1.2 6.001-6-1.221 1.716-1.708-2.13-2.133 1.411-1.408 2.136 2.129 1.667-1.66zm1.2 8.181v2h-24v-22h2v20h22z" />
                                        </svg>
                                        <div class="h6 m-0">Compare</div>
                                    </div>
                                </label>


                            </div>
                            <div class="d-flex mx-n2">

                                <label class="select-type col p-0 px-2 m-0">
                                    <input type="radio" name="chartType" value="gaugeChart" on-click="_typeSelected"
                                        required />
                                    <div class="select-type-box rounded p-4 text-center">
                                        <!-- <i class="fas fa-chart-pie fa-4x"></i> -->
                                        <svg class="mb-3" xmlns="http://www.w3.org/2000/svg" width="36" height="36"
                                            viewBox="0 0 24 24">
                                            <path
                                                d="M20.021 12.593c-.141-.427-.314-.844-.516-1.242l-2.454 1.106c.217.394.39.81.517 1.242l2.453-1.106zm-12.573-.903c.271-.354.58-.675.919-.957l-1.89-1.969c-.328.294-.637.615-.918.957l1.889 1.969zm1.715-1.515c.379-.221.781-.396 1.198-.523l-1.034-2.569c-.41.142-.812.318-1.198.524l1.034 2.568zm-2.759 3.616c.121-.435.288-.854.498-1.25l-2.469-1.066c-.197.403-.364.822-.498 1.25l2.469 1.066zm9.434-6.2c-.387-.205-.79-.379-1.2-.519l-1.024 2.573c.417.125.82.299 1.2.519l1.024-2.573zm2.601 2.13c-.282-.342-.59-.663-.918-.957l-1.89 1.969c.339.282.647.604.918.957l1.89-1.969zm-5.791-3.059c-.219-.018-.437-.026-.649-.026s-.431.009-.65.026v2.784c.216-.025.434-.038.65-.038.216 0 .434.012.649.038v-2.784zm-.648 14.338c-1.294 0-2.343-1.049-2.343-2.343 0-.883.489-1.652 1.21-2.051l1.133-5.606 1.133 5.605c.722.399 1.21 1.168 1.21 2.051 0 1.295-1.049 2.344-2.343 2.344zm12-6c0 2.184-.586 4.233-1.61 5.999l-1.736-1.003c.851-1.471 1.346-3.174 1.346-4.996 0-5.523-4.477-10-10-10s-10 4.477-10 10c0 1.822.495 3.525 1.346 4.996l-1.736 1.003c-1.024-1.766-1.61-3.815-1.61-5.999 0-6.617 5.383-12 12-12s12 5.383 12 12z" />
                                        </svg>
                                        <div class="h6 m-0">Gauge</div>
                                    </div>
                                </label>

                                <label class="select-type col p-0 px-2 m-0">
                                    <input type="radio" name="chartType" value="slider" on-click="_typeSelected"
                                        required />
                                    <div class="select-type-box rounded p-4 text-center">
                                        <!-- <i class="fas fa-table fa-4x"></i> -->
                                        <svg class="mb-3" xmlns="http://www.w3.org/2000/svg" width="36" height="36"
                                            viewBox="0 0 512 512" style="transform:rotate(90deg)">
                                            <g style="transform: translateX(128px)">
                                                <path
                                                    d="M110.3,496.9H193V15.1h-82.6V496.9z M123.7,196h55.9v287.5h-55.9V196z" />
                                            </g>
                                        </svg>
                                        <div class="h6 m-0">Slider</div>
                                    </div>
                                </label>

                                <label class="select-type col p-0 px-2 m-0">
                                    <input type="radio" name="chartType" value="table" on-click="_typeSelected"
                                        required />
                                    <div class="select-type-box rounded p-4 text-center">
                                        <!-- <i class="fas fa-table fa-4x"></i> -->
                                        <svg class="mb-3" xmlns="http://www.w3.org/2000/svg" width="36" height="36"
                                            viewBox="0 0 16 16">
                                            <g fill="none" fill-rule="evenodd" id="Icons with numbers" stroke="none"
                                                stroke-width="1">
                                                <g fill="#000000" id="Group"
                                                    transform="translate(-336.000000, -240.000000)">
                                                    <path
                                                        d="M337,240 L350,240 L350,256 L337,256 Z M338,241 L338,243 L343,243 L343,241 Z M338,244 L338,246 L343,246 L343,244 Z M338,247 L338,249 L343,249 L343,247 Z M338,250 L338,252 L343,252 L343,250 Z M338,253 L338,255 L343,255 L343,253 Z M344,241 L344,243 L349,243 L349,241 Z M344,244 L344,246 L349,246 L349,244 Z M344,247 L344,249 L349,249 L349,247 Z M344,250 L344,252 L349,252 L349,250 Z M344,253 L344,255 L349,255 L349,253 Z M344,253"
                                                        id="Rectangle 166" />
                                                </g>
                                            </g>
                                        </svg>

                                        <div class="h6 m-0">Table</div>
                                    </div>
                                </label>
                            </div>


                        </div>
                    </form>
                    <div class="modal-footer align-items-stretch">
                        <div class="flex-grow-1">
                            <template is="dom-if" if="{{selectTileTypeStatus}}">
                                <div class$="alert {{_isSuccessfulAlertClass(selectTileTypeStatus)}} border-0 m-0 p-2"
                                    role="alert">
                                    {{selectTileTypeStatus}}
                                </div>
                            </template>
                        </div>
                        <template is="dom-if" if="{{!_isSuccessful(selectTileTypeStatus)}}">
                            <div class="flex-grow-0">
                                <button type="button" class="btn btn-light" data-dismiss="modal"
                                    on-click="_closeModal_editTile">Cancel</button>
                                <button class="btn btn-primary" on-click="_submit_selectTileType">Next</button>
                            </div>
                        </template>
                    </div>

                </div>
            </div>
        </div>









        <!-- Modal - createTile -->
        <div class="modal" id="createTile_{{tabUid}}" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><button type="button" class="btn btn-outline-secondary btn-back mr-1"
                                data-dismiss="modal" data-toggle="modal" data-target$="#selectTileType{{tabUid}}"
                                data-backdrop="static" data-keyboard="false">&#129168;</button> Configure
                            {{_readableString(chartType)}}
                        </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                            on-click="_closeModal_createTile">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>


                    <form id="form_createTile{{tabUid}}">






                        <template is="dom-if" if="{{_isEqual(chartType, 'kpi')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName1">Select tag</label>
                                            <input id="createTileTagName1" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit1">Unit</label>
                                        <input id="tagUnit1" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName2">Select tag</label>
                                            <input id="createTileTagName2" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit2">Unit</label>
                                        <input id="tagUnit2" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName3">Select tag</label>
                                            <input id="createTileTagName3" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit3">Unit</label>
                                        <input id="tagUnit3" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName4">Select tag</label>
                                            <input id="createTileTagName4" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit4">Unit</label>
                                        <input id="tagUnit4" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                            </div>
                            <datalist id="createTileTagList">
                                <template is="dom-repeat" items="{{responseTagList}}">
                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                        {{item.description}}</option>
                                </template>
                            </datalist>
                        </template>







                        <template is="dom-if" if="{{_isEqual(chartType, 'lineChart')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName">Select tag <span
                                                    class="label-required">&#8727;</span></label>
                                            <input id="createTileTagName" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>

                                            <datalist id="createTileTagList">
                                                <template is="dom-repeat" items="{{responseTagList}}">
                                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                                        {{item.description}}</option>
                                                </template>
                                            </datalist>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit">Unit</label>
                                        <input id="tagUnit" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="graphPeriod">Time period</label>
                                        <select id="graphPeriod" class="form-control" autocomplete="off">
                                            <option value="8">8 hours</option>
                                            <option value="24">24 hours</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="optimumValue">Optimum value</label>
                                        <input type="text" class="form-control" id="optimumValue" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMinValue">Min threshold</label>
                                        <input type="text" class="form-control" id="alarmMinValue" autocomplete="off">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMaxValue">Max threshold</label>
                                        <input type="text" class="form-control" id="alarmMaxValue" autocomplete="off">
                                    </div>
                                </div>
                                <div class="custom-control custom-checkbox my-1 mr-sm-2">
                                    <input type="checkbox" class="custom-control-input" id="currentValue">
                                    <label class="custom-control-label" for="currentValue">Show current
                                        value</label>
                                </div>
                            </div>
                        </template>







                        <template is="dom-if" if="{{_isEqual(chartType, 'compareChart')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName1">Select tag 1 <span
                                                    class="label-required">&#8727;</span></label>
                                            <input id="createTileTagName1" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit1">Unit</label>
                                        <input id="tagUnit1" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName2">Select tag 2 <span
                                                    class="label-required">&#8727;</span></label>
                                            <input id="createTileTagName2" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit2">Unit</label>
                                        <input id="tagUnit2" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="graphPeriod">Time period</label>
                                        <select id="graphPeriod" class="form-control" autocomplete="off">
                                            <option value="8">8 hours</option>
                                            <option value="24">24 hours</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="optimumValue">Optimum value</label>
                                        <input type="text" class="form-control" id="optimumValue" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMinValue">Min threshold</label>
                                        <input type="text" class="form-control" id="alarmMinValue" autocomplete="off">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMaxValue">Max threshold</label>
                                        <input type="text" class="form-control" id="alarmMaxValue" autocomplete="off">
                                    </div>
                                </div>
                            </div>
                            <datalist id="createTileTagList">
                                <template is="dom-repeat" items="{{responseTagList}}">
                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                        {{item.description}}</option>
                                </template>
                            </datalist>
                        </template>








                        <template is="dom-if" if="{{_isEqual(chartType, 'gaugeChart')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName">Select tag <span
                                                    class="label-required">&#8727;</span></label>
                                            <input id="createTileTagName" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>

                                            <datalist id="createTileTagList">
                                                <template is="dom-repeat" items="{{responseTagList}}">
                                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                                        {{item.description}}</option>
                                                </template>
                                            </datalist>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit">Unit</label>
                                        <input id="tagUnit" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMinValue">Min</label>
                                        <input type="text" class="form-control" id="alarmMinValue" autocomplete="off">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMaxValue">Max</label>
                                        <input type="text" class="form-control" id="alarmMaxValue" autocomplete="off">
                                    </div>
                                </div>
                            </div>
                        </template>







                        <template is="dom-if" if="{{_isEqual(chartType, 'slider')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-8 form-group">
                                            <label for="createTileTagName">Select tag <span
                                                    class="label-required">&#8727;</span></label>
                                            <input id="createTileTagName" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>

                                            <datalist id="createTileTagList">
                                                <template is="dom-repeat" items="{{responseTagList}}">
                                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                                        {{item.description}}</option>
                                                </template>
                                            </datalist>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagTarget">Target</label>
                                        <input id="tagTarget" type="text" class="form-control" autocomplete="off">
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit">Unit</label>
                                        <input id="tagUnit" type="text" class="form-control" autocomplete="off">
                                    </div>

                                </div>
                                <!-- <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMinValue">Min</label>
                                        <input type="text" class="form-control" id="alarmMinValue" autocomplete="off">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMaxValue">Max</label>
                                        <input type="text" class="form-control" id="alarmMaxValue" autocomplete="off">
                                    </div>
                                </div> -->


                                <template id="sliderThresholds" is="dom-repeat" items="{{sliderThresholds}}"
                                    as="listItem">
                                    <div class="form-row">
                                        <div class="col flex-grow-1 form-group">
                                            <input type="number" id$="{{listItem.from}}" class="form-control"
                                                placeholder="From">
                                        </div>
                                        <div class="col flex-grow-1 form-group">
                                            <input type="number" id$="{{listItem.to}}" class="form-control"
                                                placeholder="To">
                                        </div>
                                        <div class="col flex-grow-1 form-group">
                                            <input type="color" id$="{{listItem.color}}" class="form-control"
                                                placeholder="Color">
                                        </div>
                                        <div class="col flex-grow-0 form-group text-right">
                                            <button class="btn btn-outline-danger" id="{{listItem.id}}"
                                                on-click="_removeThreshold">x</button>
                                        </div>
                                    </div>
                                </template>

                                <div class="form-row">
                                    <div class="col flex-grow-1 form-group text-right">
                                        <button class="btn btn-outline-secondary" on-click="_addThreshold">+ Add
                                            threshold</button>
                                    </div>
                                </div>

                            </div>
                        </template>







                        <template is="dom-if" if="{{_isEqual(chartType, 'table')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <div class="col-md-12 form-group">
                                        <label for="createTileTitle">Title <span
                                                class="label-required">&#8727;</span></label>
                                        <input id="createTileTitle" class="form-control" placeholder="Title"
                                            autocomplete="off" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName1">Select tag</label>
                                            <input id="createTileTagName1" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit1">Unit</label>
                                        <input id="tagUnit1" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName2">Select tag</label>
                                            <input id="createTileTagName2" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit2">Unit</label>
                                        <input id="tagUnit2" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName3">Select tag</label>
                                            <input id="createTileTagName3" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit3">Unit</label>
                                        <input id="tagUnit3" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName4">Select tag</label>
                                            <input id="createTileTagName4" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit4">Unit</label>
                                        <input id="tagUnit4" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName5">Select tag</label>
                                            <input id="createTileTagName5" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit5">Unit</label>
                                        <input id="tagUnit5" type="text" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                            </div>
                            <datalist id="createTileTagList">
                                <template is="dom-repeat" items="{{responseTagList}}">
                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                        {{item.description}}</option>
                                </template>
                            </datalist>
                        </template>





                    </form>


                    <div class="modal-footer align-items-stretch">
                        <div class="flex-grow-1">
                            <template is="dom-if" if="{{createDashboardTileStatus}}">
                                <div class$="alert {{_isSuccessfulAlertClass(createDashboardTileStatus)}} border-0 m-0 p-2"
                                    role="alert">
                                    {{createDashboardTileStatus}}
                                </div>
                            </template>
                        </div>
                        <template is="dom-if" if="{{!_isSuccessful(createDashboardTileStatus)}}">
                            <div class="flex-grow-0">
                                <button type="button" class="btn btn-light" data-dismiss="modal"
                                    on-click="_closeModal_createTile">Cancel</button>
                                <button class="btn btn-primary" on-click="_submit_createTile">Add tile</button>
                            </div>
                        </template>
                    </div>


                </div>
            </div>
        </div>







        <!-- Modal - editTile -->
        <div class="modal" id$="editTile_{{tabUid}}" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addToDashboardTitle">Configure
                            {{_readableString(editDashboardTileData.tile_type)}}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                            on-click="_closeModal_editTile">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>




                    <form id="form_editTile{{tabUid}}">





                        <template is="dom-if" if="{{_isEqual(editDashboardTileData.tile_type, 'kpi')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName1">Select tag</label>
                                            <input id="createTileTagName1" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.0.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit1">Unit</label>
                                        <input id="tagUnit1" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.0.unit}}">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName2">Select tag</label>
                                            <input id="createTileTagName2" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.1.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit2">Unit</label>
                                        <input id="tagUnit2" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.1.unit}}">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName3">Select tag</label>
                                            <input id="createTileTagName3" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.2.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit3">Unit</label>
                                        <input id="tagUnit3" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.2.unit}}">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName4">Select tag</label>
                                            <input id="createTileTagName4" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.3.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit4">Unit</label>
                                        <input id="tagUnit4" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.4.unit}}">
                                    </div>
                                </div>
                            </div>
                            <datalist id="createTileTagList">
                                <template is="dom-repeat" items="{{responseTagList}}">
                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                        {{item.description}}</option>
                                </template>
                            </datalist>
                        </template>








                        <template is="dom-if" if="{{_isEqual(editDashboardTileData.tile_type, 'lineChart')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <div class="col-md-10 form-group">
                                        <label for="createTileTagName">Select tag <span
                                                class="label-required">&#8727;</span></label>
                                        <input id="createTileTagName" class="form-control" list="createTileTagList"
                                            placeholder="Tag id" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tag_name}}">
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit">Unit</label>
                                        <input id="tagUnit" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.unit}}">
                                    </div>
                                </div>

                                <div class=" form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="graphPeriod">Time period</label>
                                        <select id="graphPeriod" class="form-control" autocomplete="off">
                                            <option value="8"
                                                selected$="{{_markSelected(editDashboardTileData.tile_config.graph_period, 8)}}">
                                                8 hours
                                            </option>
                                            <option value="24"
                                                selected$="{{_markSelected(editDashboardTileData.tile_config.graph_period, 24)}}">
                                                24 hours
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="optimumValue">Optimum value</label>
                                        <input type="text" class="form-control" id="optimumValue" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.optimum_value}}">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMinValue">Min threshold</label>
                                        <input type="text" class="form-control" id="alarmMinValue" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.alarm_min_value}}">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMaxValue">Max threshold</label>
                                        <input type="text" class="form-control" id="alarmMaxValue" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.alarm_max_value}}">
                                    </div>
                                </div>

                                <div class="custom-control custom-checkbox my-1 mr-sm-2">
                                    <input type="checkbox" class="custom-control-input" id="currentValue"
                                        checked="{{editDashboardTileData.tile_config.current_value}}">
                                    <label class="custom-control-label" for="currentValue">Show current
                                        value</label>
                                </div>
                            </div>
                            <datalist id="createTileTagList">
                                <template is="dom-repeat" items="{{responseTagList}}">
                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                        {{item.description}}</option>
                                </template>
                            </datalist>
                        </template>








                        <template is="dom-if" if="{{_isEqual(editDashboardTileData.tile_type, 'compareChart')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <div class="col-md-10 form-group">
                                        <label for="createTileTagName1">Select tag 1 <span
                                                class="label-required">&#8727;</span></label>
                                        <input id="createTileTagName1" class="form-control" list="createTileTagList"
                                            placeholder="Tag id" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tag_name1}}">
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit1">Unit</label>
                                        <input id="tagUnit1" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.unit1}}">
                                    </div>
                                </div>


                                <div class="form-row">
                                    <div class="col-md-10 form-group">
                                        <label for="createTileTagName2">Select tag 2 <span
                                                class="label-required">&#8727;</span></label>
                                        <input id="createTileTagName2" class="form-control" list="createTileTagList"
                                            placeholder="Tag id" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tag_name2}}">
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit2">Unit</label>
                                        <input id="tagUnit2" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.unit2}}">
                                    </div>
                                </div>

                                <div class=" form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="graphPeriod">Time period</label>
                                        <select id="graphPeriod" class="form-control" autocomplete="off">
                                            <option value="8"
                                                selected$="{{_markSelected(editDashboardTileData.tile_config.graph_period, 8)}}">
                                                8 hours
                                            </option>
                                            <option value="24"
                                                selected$="{{_markSelected(editDashboardTileData.tile_config.graph_period, 24)}}">
                                                24 hours
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="optimumValue">Optimum value</label>
                                        <input type="text" class="form-control" id="optimumValue" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.optimum_value}}">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMinValue">Min threshold</label>
                                        <input type="text" class="form-control" id="alarmMinValue" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.alarm_min_value}}">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMaxValue">Max threshold</label>
                                        <input type="text" class="form-control" id="alarmMaxValue" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.alarm_max_value}}">
                                    </div>
                                </div>

                            </div>
                            <datalist id="createTileTagList">
                                <template is="dom-repeat" items="{{responseTagList}}">
                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                        {{item.description}}</option>
                                </template>
                            </datalist>
                        </template>











                        <template is="dom-if" if="{{_isEqual(editDashboardTileData.tile_type, 'gaugeChart')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName">Select tag <span
                                                    class="label-required">&#8727;</span></label>
                                            <input id="createTileTagName" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tag_name}}">

                                            <datalist id="createTileTagList">
                                                <template is="dom-repeat" items="{{responseTagList}}">
                                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                                        {{item.description}}</option>
                                                </template>
                                            </datalist>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit">Unit</label>
                                        <input id="tagUnit" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.unit}}">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMinValue">Min</label>
                                        <input type="text" class="form-control" id="alarmMinValue" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.min_value}}">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="alarmMaxValue">Max</label>
                                        <input type="text" class="form-control" id="alarmMaxValue" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.max_value}}">
                                    </div>
                                </div>
                            </div>
                        </template>











                        <template is="dom-if" if="{{_isEqual(editDashboardTileData.tile_type, 'slider')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-8 form-group">
                                            <label for="createTileTagName">Select tag <span
                                                    class="label-required">&#8727;</span></label>
                                            <input id="createTileTagName" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tag_name}}">

                                            <datalist id="createTileTagList">
                                                <template is="dom-repeat" items="{{responseTagList}}">
                                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                                        {{item.description}}</option>
                                                </template>
                                            </datalist>
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagTarget">Target</label>
                                        <input id="tagTarget" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tag_target}}">
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit">Unit</label>
                                        <input id="tagUnit" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.unit}}">
                                    </div>
                                </div>


                                <template is="dom-repeat" items="{{editDashboardTileData.tile_config.thresholds}}"
                                    as="listItem">
                                    <div class="form-row">
                                        <div class="col flex-grow-1 form-group">
                                            <input type="number" id="_from{{_replaceDot(listItem.from)}}"
                                                value="{{listItem.from}}" class="form-control" placeholder="From">
                                        </div>
                                        <div class="col flex-grow-1 form-group">
                                            <input type="number" id="_to{{_replaceDot(listItem.to)}}"
                                                value="{{listItem.to}}" class="form-control" placeholder="To">
                                        </div>
                                        <div class="col flex-grow-1 form-group">
                                            <input type="color" id="_color{{_replaceDot(listItem.color)}}"
                                                value="{{listItem.color}}" class="form-control" placeholder="Color">
                                        </div>
                                        <div class="col flex-grow-0 form-group text-right">
                                            <button class="btn btn-outline-danger" id="id_{{index}}"
                                                on-click="_removeDefinedThreshold">x</button>
                                        </div>
                                    </div>
                                </template>


                                <template is="dom-repeat" items="{{sliderThresholds}}" as="listItem">
                                    <div class="form-row">
                                        <div class="col flex-grow-1 form-group">
                                            <input type="number" id="{{listItem.from}}" class="form-control"
                                                placeholder="From">
                                        </div>
                                        <div class="col flex-grow-1 form-group">
                                            <input type="number" id="{{listItem.to}}" class="form-control"
                                                placeholder="To">
                                        </div>
                                        <div class="col flex-grow-1 form-group">
                                            <input type="color" id="{{listItem.color}}" class="form-control"
                                                placeholder="Color">
                                        </div>
                                        <div class="col flex-grow-0 form-group text-right">
                                            <button class="btn btn-outline-danger" id="{{listItem.id}}"
                                                on-click="_removeThreshold">x</button>
                                        </div>
                                    </div>
                                </template>

                                <div class="form-row">
                                    <div class="col flex-grow-1 form-group text-right">
                                        <button class="btn btn-outline-secondary" on-click="_addThreshold">+ Add
                                            threshold</button>
                                    </div>
                                </div>

                            </div>
                        </template>










                        <template is="dom-if" if="{{_isEqual(editDashboardTileData.tile_type, 'table')}}">
                            <div class="modal-body">
                                <div class="form-row">
                                    <div class="col-md-12 form-group">
                                        <label for="createTileTitle">Title <span
                                                class="label-required">&#8727;</span></label>
                                        <input id="createTileTitle" class="form-control" placeholder="Title"
                                            autocomplete="off" required
                                            value="{{editDashboardTileData.tile_config.tileTitle}}">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName1">Select tag</label>
                                            <input id="createTileTagName1" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.0.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit1">Unit</label>
                                        <input id="tagUnit1" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.0.unit}}">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName2">Select tag</label>
                                            <input id="createTileTagName2" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.1.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit2">Unit</label>
                                        <input id="tagUnit2" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.1.unit}}">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName3">Select tag</label>
                                            <input id="createTileTagName3" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.2.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit3">Unit</label>
                                        <input id="tagUnit3" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.2.unit}}">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName4">Select tag</label>
                                            <input id="createTileTagName4" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.3.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit4">Unit</label>
                                        <input id="tagUnit4" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.3.unit}}">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <template is="dom-if" if="{{responseTagList}}">
                                        <div class="col-md-10 form-group">
                                            <label for="createTileTagName5">Select tag</label>
                                            <input id="createTileTagName5" list="createTileTagList" class="form-control"
                                                placeholder="Tag id" autocomplete="off" required
                                                value="{{editDashboardTileData.tile_config.tags.4.tag_name}}">
                                        </div>
                                    </template>
                                    <div class="col-md-2 form-group">
                                        <label for="tagUnit5">Unit</label>
                                        <input id="tagUnit5" type="text" class="form-control" autocomplete="off"
                                            value="{{editDashboardTileData.tile_config.tags.4.unit}}">
                                    </div>
                                </div>
                            </div>
                            <datalist id="createTileTagList">
                                <template is="dom-repeat" items="{{responseTagList}}">
                                    <option value="{{item.tag_name}}" data-max-date="{{item.max_date}}">
                                        {{item.description}}</option>
                                </template>
                            </datalist>
                        </template>






                    </form>




                    <div class="modal-footer align-items-stretch">
                        <div class="flex-grow-1">
                            <template is="dom-if" if="{{editDashboardTileStatus}}">
                                <div class$="alert {{_isSuccessfulAlertClass(editDashboardTileStatus)}} border-0 m-0 p-2"
                                    role="alert">
                                    {{editDashboardTileStatus}}
                                </div>
                            </template>
                        </div>
                        <template is="dom-if" if="{{!_isSuccessful(editDashboardTileStatus)}}">
                            <div class="flex-grow-0">
                                <button type="button" class="btn btn-light" data-dismiss="modal"
                                    on-click="_closeModal_editTile">Cancel</button>
                                <button type="button" class="btn btn-primary" on-click="_submit_editTile"
                                    data-form-type$="{{editDashboardTileData.tile_type}}">Save
                                    changes</button>
                            </div>
                        </template>
                    </div>


                </div>
            </div>
        </div>










        <!-- Modal - deleteMultiDashboardTile -->
        <div class="modal" id$="deleteGraph{{tabUid}}" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addToDashboardTitle">Delete tile</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                            on-click="_closeModal_deleteMultiDashboardTile">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>


                    <div class="modal-body">
                        Are you sure, you want to delete {{deleteDashboardTileData.tile_config.tag_name}}?
                    </div>


                    <div class="modal-footer align-items-stretch">
                        <div class="flex-grow-1">
                            <template is="dom-if" if="{{deleteDashboardTileStatus}}">
                                <div class$="alert {{_isSuccessfulAlertClass(deleteDashboardTileStatus)}} border-0 m-0 p-2"
                                    role="alert">
                                    {{deleteDashboardTileStatus}}
                                </div>
                            </template>
                        </div>

                        <template is="dom-if" if="{{!_isSuccessful(deleteDashboardTileStatus)}}">
                            <div class="flex-grow-0">
                                <button type="button" class="btn btn-light" data-dismiss="modal"
                                    on-click="_closeModal_deleteMultiDashboardTile">Cancel</button>
                                <button type="button" class="btn btn-danger"
                                    on-click="_submit_deleteMultiDashboardTile">Yes, Delete</button>
                            </div>
                        </template>

                    </div>
                </div>
            </div>
        </div>


    </template>

    <script>
        Polymer({
            is: "dashboard-tab",

            properties: {
                userId: {
                    value: function () {
                        return window.user_id
                    }
                },
                orgId: {
                    value: function () {
                        return window.organization_id
                    }
                },
                getMultiDashboardTilesResponse: {
                    value: null
                },
                tabUid: {
                    notify: true,
                    computed: '_tabUid(dashboardId)'
                },
                sliderThresholds: {
                    value: []
                }
            },

            created: function () {
                /* console.log(this.localName + '#' + this.id + ' was created'); */
            },

            ready: function () {
                /* console.log(this.localName + '#' + this.id + ' has local DOM initialized'); */
            },

            attached: function () {
                console.log(this.localName + '#' + this.id + this.dashboardId + ' was attached');

                document.documentElement.classList.remove('in-progress');

                var _tooltipContainers = document.querySelectorAll('.highcharts-tooltip-container[style*="-9999px"]');
                if (_tooltipContainers.length < 0) {
                    _tooltipContainers.forEach(function (e, i) {
                        e.parentNode.removeChild(e);
                    });
                }
            },

            detached: function () {
                /* console.log(this.localName + '#' + this.id + ' was detached'); */
            },

            attributeChanged: function (name, type) {
                /* console.log(this.localName + '#' + this.id + ' attribute ' + name +
                    ' was changed to ' + this.getAttribute(name)); */
            },

            _readableString: function (str) {
                return str.replace(/([A-Z])/g, ' $1').replace(/^./, function (str) { return str }).toLowerCase();
            },

            _tabUid: function () {
                return '_tabUid' + Math.round(new Date().valueOf() * Math.random());
                // return '';
            },

            _isContain: function (inputString, searchString) {
                if (!inputString || !searchString) return;
                return inputString.toString().indexOf(searchString) > -1
            },

            _isSuccessfulAlertClass: function (inputString) {
                if (!inputString) return;
                if (inputString.indexOf('successfully') > -1) {
                    return 'alert-success'
                } else {
                    return 'alert-danger'
                }
            },

            _isSuccessful: function (inputString) {
                if (!inputString) return;
                return inputString.indexOf('successfully') > -1
            },

            _isEqual: function (first, second) {
                return first === second
            },

            _markSelected: function (selectedDuration, duration) {
                // console.log('_markSelected', selectedDuration, duration);
                if (selectedDuration === duration) {
                    return true
                } else {
                    return false
                }
            },




            _addThreshold: function (e) {
                e.preventDefault();
                var _root = this;

                var uuid = Math.round(new Date().valueOf() * Math.random());

                var defineThreashold = function () {
                    _root.push("sliderThresholds", {
                        'id': '_id' + uuid,
                        'from': '_from' + uuid,
                        'to': '_to' + uuid,
                        'color': '_color' + uuid
                    });
                }

                // console.log('!_root.sliderThresholds.length', !_root.sliderThresholds.length)
                if (!_root.sliderThresholds.length) {
                    console.log('if')
                    _root.sliderThresholds = [];
                    defineThreashold();
                } else {
                    console.log('else')
                    var flagDefineThreshold = false;
                    _root.sliderThresholds.forEach(function (item, index) {
                        console.log(item)
                        var thresholdFrom = _root.querySelector('#' + item.from).value;
                        var thresholdTo = _root.querySelector('#' + item.to).value;
                        var thresholdColor = _root.querySelector('#' + item.color).value;
                        console.log(thresholdFrom, thresholdTo, thresholdColor, thresholdFrom && thresholdTo && thresholdColor)
                        if (thresholdFrom && thresholdTo && thresholdColor) {
                            flagDefineThreshold = true;
                        } else {
                            flagDefineThreshold = false;
                        }
                    });

                    if (flagDefineThreshold) {
                        defineThreashold();
                    }
                }
            },


            _replaceDot: function (str) {
                return str.replace(/\./g, '_').replace(/\#/g, '_');
            },



            _removeThreshold: function (e) {
                // e.preventDefault();
                var index = this.sliderThresholds.findIndex(function (item) {
                    return item.id == e.target.id
                });
                this.splice('sliderThresholds', index, 1);
            },



            _removeDefinedThreshold: function (e) {
                e.preventDefault();

                var index = this.editDashboardTileData.tile_config.thresholds.findIndex(function (item, i) {
                    return 'id_' + i === e.target.id
                });
                this.splice('editDashboardTileData.tile_config.thresholds', index, 1);
            },




            _onResponse_getMultiDashboardTiles: function (e) {
                var _root = this;

                if (e.detail.response.status) {
                    _root.getMultiDashboardTilesResponse = null;
                } else if (e.detail.response && !e.detail.response.status) {
                    _root.getMultiDashboardTilesResponse = e.detail.response;
                }


                _root.async(function () {
                    /* $(_root.querySelectorAll('.sortable')).sortable({
                        items: ':not(.disabled)',
                        handle: '.handle'
                    }).bind('sortupdate',
                        function (e) {
                            //Triggered when the user stopped sorting and the DOM position has changed.
                            var items = _root.querySelectorAll(
                                '.sortable-item');
                            var orderedItems = [];
                            for (var i = 0; i < items.length; i++) {
                                var item = items[i];
                                orderedItems.push({
                                    'tile_id': item.dataset.tileId,
                                    'sort_id': i
                                });
                            }

                            var maintainTilesOrder = _root.querySelector('#maintainTilesOrder');
                            maintainTilesOrder.body = orderedItems;
                            maintainTilesOrder.generateRequest();
                        }); */



                    /* interact('.draggable') */
                    /* .draggable({
                        inertia: true,
                        allowFrom: '.handle',
                        cursorChecker: function (action, interactable, element, interacting) {
                            switch (action.axis) {
                                case 'x': return 'ew-resize'
                                case 'y': return 'ns-resize'
                                default: return interacting ? 'grabbing' : 'grab'
                            }
                        }
                    }).on('dragmove', function (event) {
                        var target = event.target;

                        var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                        var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

                        // translate the element
                        target.style.webkitTransform = target.style.transform = 'translate(' + x + 'px, ' + y + 'px)';

                        // update the posiion attributes
                        target.setAttribute('data-x', x);
                        target.setAttribute('data-y', y);

                        var tile = target.querySelector('.tile');
                        tile.setAttribute('data-x', event.dx)
                        tile.setAttribute('data-y', event.dy)
                    }).on('dragend', function (event) {
                        var target = event.target;

                        console.log('dragend', event.dx, event.dy);
                    }) */
                    /* .resizable({
                        inertia: {
                            resistance: 30
                        },
                        edges: { left: false, right: true, bottom: true, top: false },
                        restrictSize: {
                            min: { width: 450, height: 250 }
                        }
                    }).on('resizemove', function (event) {
                        var target = event.target;

                        target.style.width = event.rect.width + 'px';
                        target.style.height = event.rect.height + 'px';

                        var tile = target.querySelector('.tile');
                        tile.setAttribute('data-width', event.rect.width)
                        tile.setAttribute('data-height', event.rect.height)

                    }).on('resizeend', function (event) {
                        var target = event.target;
                        target.setAttribute('data-width', event.rect.width)
                        target.setAttribute('data-height', event.rect.height)

                        var tiles = document.querySelectorAll('.dashboard-tile');
                        tiles.forEach(function (item, i) {
                            var rect = item.getBoundingClientRect();
                            x = rect.left;
                            y = rect.top - (document.querySelector('ul.nav').getBoundingClientRect().height + document.querySelector('.navbar').getBoundingClientRect().height);
                            w = rect.width;
                            h = rect.height;

                            console.log("Left: " + x + ", Top: " + y + ", Width: " + w + ", Height: " + h, item.dataset.tileId, $(item).data('draggabilly'))
                        })
                    });



                _root.draggables = $(_root.querySelectorAll('.draggable')).draggabilly({
                    grid: [20, 20]
                });

                _root.draggables.on( 'dragEnd', function( event, pointer ) {
                    console.log('dragEnd', event, pointer);
                    var target = event.target;
                    target.setAttribute('data-x', event.rect.width)
                    target.setAttribute('data-height', event.rect.height)
                }) */


                    var saveActions = function () {
                        var tiles = _root.querySelectorAll('.tile');

                        var tilesData = [];
                        tiles.forEach(function (item, i) {
                            /* console.log("left: " + item.dataset.left + ", top: " + item.dataset.top + ", width: " + item.dataset.width + ", height: " + item.dataset.height, "z: " + item.dataset.z, "tile-id: " + item.dataset.tileId); */
                            tilesData.push({
                                'tile_id': item.dataset.tileId,
                                'sort_id': i,
                                'cords_config': {
                                    'left': item.dataset.left,
                                    'top': item.dataset.top,
                                    'width': item.dataset.width,
                                    'height': item.dataset.height
                                }
                            });
                        });

                        var maintainTilesOrder = _root.querySelector('#maintainTilesOrder');
                            maintainTilesOrder.body = tilesData;
                            maintainTilesOrder.generateRequest();

                            
                    }



                    $(_root.querySelectorAll(".dashboard-tile")).draggable({
                        cursor: "move",
                        snap: true,
                        snapTolerance: 10,
                        grid: [1, 1],
                        scroll: true,
                        stack: ".dashboard-tile",
                        stop: function (event, ui) {
                            // console.log(ui.helper[0].style.zIndex)
                            event.target.style.zIndex = 'auto';
                            var tile = event.target.querySelector('.tile');
                            console.log('tile', tile)
                            tile.setAttribute('data-left', ui.position.left);
                            tile.setAttribute('data-top', ui.position.top);
                            saveActions();
                        }
                    }).resizable({
                        grid: 1,
                        minHeight: 250,
                        minWidth: 250,
                        snap: true,
                        snapTolerance: 10,
                        scroll: true, 
                        resize: function (event, ui) {
                            var tile = event.target.querySelector('.tile');
                            tile.setAttribute('data-width', ui.size.width);
                            tile.setAttribute('data-height', ui.size.height);
                        },
                        stop: function (event, ui) {
                            var tile = event.target.querySelector('.tile');
                            tile.setAttribute('data-width', ui.size.width);
                            tile.setAttribute('data-height', ui.size.height);
                            saveActions();
                        }
                    });



                }, 1000);


                /* _root.async(function () {
                    window.stop();
                    // e.target.generateRequest();
                    document.querySelector('#getMultiDashboardTiles').generateRequest();
                }, 60000); */


                /* var secondsLeft = 61;
                var interval = setInterval(function () {
                    if (!document.querySelector('.modal.show')) {
                        secondsLeft = --secondsLeft;
                        if (secondsLeft <= 0) {
                            window.stop();
                            clearInterval(interval);
                            _root.querySelector('#getMultiDashboardTiles').generateRequest();
                        }
                    }
                }, 1000); */
            },


            _onResponse_maintainTilesOrder: function (e) {
                // console.log('_onResponse_maintainTilesOrder', e.detail.response);
            },









            /*createTile - START*/
            _addNew: function (e) {
                e.preventDefault();
                this.selectTileTypeStatus = null;
                this.sliderThresholds = [];


                if (this.querySelector('#formSelectTileType' + this.tabUid)) {
                    this.querySelector('#formSelectTileType' + this.tabUid).reset();
                }

                if (this.querySelector('#form_createTile' + this.tabUid)) {
                    this.querySelector('#form_createTile' + this.tabUid).reset();
                }


            },

            _typeSelected: function (e) {
                this.selectTileTypeStatus = null;
            },

            _submit_selectTileType: function (e) {
                e.preventDefault();
                this.createDashboardTileStatus = null;


                var chartTypeChecked = this.querySelector('[name=chartType]:checked');
                if (chartTypeChecked) {

                    $(this.querySelector('#selectTileType' + this.tabUid)).modal('hide');

                    var chartType = this.chartType = chartTypeChecked.value;
                    // console.log(this.chartType)

                    $(this.querySelector('#createTile_' + this.tabUid)).modal({
                        keyboard: false,
                        backdrop: 'static'
                    }).modal('show');
                } else {
                    this.selectTileTypeStatus = 'Please select a type';
                }
            },

            _submit_createTile: function (e) {
                e.preventDefault();

                // console.log('chartType', this.chartType);

                var createChartData = new FormData();



                var items = this.querySelectorAll('.sortable-item');
                var itemSortId = items.length;
                // console.log('items', items, itemSortId)




                if (this.chartType === 'lineChart') {
                    var tagName = this.querySelector('#createTileTagName').value;

                    var tagSelected = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName
                    });

                    if (!tagSelected) {
                        this.createDashboardTileStatus = 'Please select a tag';
                        return;
                    }

                    var tagUnit = this.querySelector('#tagUnit').value || null;
                    var graphPeriod = parseInt(this.querySelector('#graphPeriod').value);
                    var optimumValue = this.querySelector('#optimumValue').value || null;
                    var alarmMinValue = this.querySelector('#alarmMinValue').value || null;
                    var alarmMaxValue = this.querySelector('#alarmMaxValue').value || null;
                    var currentValue = this.querySelector('#currentValue').checked;

                    createChartData = {
                        'dashboard_id': this.dashboardId,
                        'tile_type': this.chartType,
                        'description': '',
                        'sort_id': itemSortId,
                        'tile_config': {
                            'tag_name': tagSelected.tag_name,
                            'tag_id': tagSelected.tag_id,
                            'max_date': tagSelected.max_date,
                            'unit': tagUnit,
                            'graph_period': graphPeriod,
                            'optimum_value': optimumValue,
                            'alarm_min_value': alarmMinValue,
                            'alarm_max_value': alarmMaxValue,
                            'current_value': currentValue
                        }
                    }
                }







                if (this.chartType === 'compareChart') {
                    var tagName1 = this.querySelector('#createTileTagName1').value;
                    var tagSelected1 = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName1
                    });
                    var tagUnit1 = this.querySelector('#tagUnit1').value || null;

                    if (!tagSelected1) {
                        this.createDashboardTileStatus = 'Please select tag 1';
                        return;
                    }


                    var tagName2 = this.querySelector('#createTileTagName2').value;
                    var tagSelected2 = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName2
                    });
                    var tagUnit2 = this.querySelector('#tagUnit2').value || null;

                    if (!tagSelected2) {
                        this.createDashboardTileStatus = 'Please select tag 2';
                        return;
                    }


                    var graphPeriod = parseInt(this.querySelector('#graphPeriod').value);
                    var optimumValue = this.querySelector('#optimumValue').value || null;
                    var alarmMinValue = this.querySelector('#alarmMinValue').value || null;
                    var alarmMaxValue = this.querySelector('#alarmMaxValue').value || null;

                    createChartData = {
                        'dashboard_id': this.dashboardId,
                        'tile_type': this.chartType,
                        'description': '',
                        'tile_config': {
                            'tag_name1': tagSelected1.tag_name,
                            'tag_id1': tagSelected1.tag_id,
                            'max_date1': tagSelected1.max_date,
                            'unit1': tagUnit1,

                            'tag_name2': tagSelected2.tag_name,
                            'tag_id2': tagSelected2.tag_id,
                            'max_date2': tagSelected2.max_date,
                            'unit2': tagUnit2,

                            'graph_period': graphPeriod,
                            'optimum_value': optimumValue,
                            'alarm_min_value': alarmMinValue,
                            'alarm_max_value': alarmMaxValue
                        }
                    }
                }







                if (this.chartType === 'gaugeChart') {
                    var tagName = this.querySelector('#createTileTagName').value;
                    var tagSelected = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName
                    });

                    if (!tagSelected) {
                        this.createDashboardTileStatus = 'Please select a tag';
                        return;
                    }

                    var tagUnit = this.querySelector('#tagUnit').value || null;
                    var alarmMinValue = this.querySelector('#alarmMinValue').value || null;
                    var alarmMaxValue = this.querySelector('#alarmMaxValue').value || null;

                    createChartData = {
                        'dashboard_id': this.dashboardId,
                        'tile_type': this.chartType,
                        'description': null,
                        'sort_id': itemSortId,
                        'tile_config': {
                            'tag_name': tagSelected.tag_name,
                            'tag_id': tagSelected.tag_id,
                            'max_date': tagSelected.max_date,
                            'unit': tagUnit,
                            'min_value': alarmMinValue,
                            'max_value': alarmMaxValue
                        }
                    }
                }








                if (this.chartType === 'slider') {
                    var _root = this;

                    var sliderThresholdValues = [];
                    _root.sliderThresholds.forEach(function (item, index) {
                        var thresholdFrom = _root.querySelector('#' + item.from).value;
                        var thresholdTo = _root.querySelector('#' + item.to).value;
                        var thresholdColor = _root.querySelector('#' + item.color).value;
                        if (thresholdFrom && thresholdTo, thresholdColor) {
                            sliderThresholdValues.push({
                                'from': thresholdFrom,
                                'to': thresholdTo,
                                'color': thresholdColor
                            });
                        }
                    });
                    // console.log('sliderThresholdValues', sliderThresholdValues);


                    var tagName = this.querySelector('#createTileTagName').value;
                    var tagSelected = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName
                    });
                    if (!tagSelected) {
                        this.createDashboardTileStatus = 'Please select a tag';
                        return;
                    }

                    var tagUnit = this.querySelector('#tagUnit').value || null;
                    var tagTarget = this.querySelector('#tagTarget').value || null;
                    // var alarmMinValue = this.querySelector('#alarmMinValue').value || null;
                    // var alarmMaxValue = this.querySelector('#alarmMaxValue').value || null;

                    createChartData = {
                        'dashboard_id': this.dashboardId,
                        'tile_type': this.chartType,
                        'description': null,
                        'sort_id': itemSortId,
                        'tile_config': {
                            'tag_name': tagSelected.tag_name,
                            'tag_id': tagSelected.tag_id,
                            'max_date': tagSelected.max_date,
                            'unit': tagUnit,
                            'thresholds': sliderThresholdValues,
                            'tag_target': tagTarget
                        }
                    }
                }








                if (this.chartType === 'kpi') {

                    var tagsData = [];

                    var tagName1 = this.querySelector('#createTileTagName1');
                    if (tagName1.value) {
                        var tagSelected1 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName1.value
                        });
                        if (tagSelected1) {
                            var tagUnit1 = this.querySelector('#tagUnit1').value;
                            tagsData.push({
                                'tag_name': tagSelected1.tag_name,
                                'tag_id': tagSelected1.tag_id,
                                'max_date': tagSelected1.max_date,
                                'unit': tagUnit1
                            });
                        }
                    }


                    var tagName2 = this.querySelector('#createTileTagName2');
                    if (tagName2.value) {
                        var tagSelected2 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName2.value
                        });
                        if (tagSelected2) {
                            var tagUnit2 = this.querySelector('#tagUnit2').value;
                            tagsData.push({
                                'tag_name': tagSelected2.tag_name,
                                'tag_id': tagSelected2.tag_id,
                                'max_date': tagSelected2.max_date,
                                'unit': tagUnit2
                            });
                        }
                    }

                    var tagName3 = this.querySelector('#createTileTagName3');
                    if (tagName3.value) {
                        var tagSelected3 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName3.value
                        });
                        if (tagSelected3) {
                            var tagUnit3 = this.querySelector('#tagUnit3').value;
                            tagsData.push({
                                'tag_name': tagSelected3.tag_name,
                                'tag_id': tagSelected3.tag_id,
                                'max_date': tagSelected3.max_date,
                                'unit': tagUnit3
                            });
                        }
                    }


                    var tagName4 = this.querySelector('#createTileTagName4');
                    if (tagName4.value) {
                        var tagSelected4 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName4.value
                        });
                        if (tagSelected4) {
                            var tagUnit4 = this.querySelector('#tagUnit4').value;
                            tagsData.push({
                                'tag_name': tagSelected4.tag_name,
                                'tag_id': tagSelected4.tag_id,
                                'max_date': tagSelected4.max_date,
                                'unit': tagUnit4
                            });
                        }
                    }



                    createChartData = {
                        'dashboard_id': this.dashboardId,
                        'tile_type': this.chartType,
                        'description': null,
                        'sort_id': itemSortId,
                        'tile_config': {
                            'tags': tagsData
                        }
                    }

                }








                if (this.chartType === 'table') {
                    var tagsData = [];



                    var createTileTitle = this.querySelector('#createTileTitle').value || null;
                    if (!createTileTitle) {
                        this.createDashboardTileStatus = 'Please provide a title';
                        return;
                    }

                    var tagName1 = this.querySelector('#createTileTagName1');
                    if (tagName1.value) {
                        var tagSelected1 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName1.value
                        });
                        if (tagSelected1) {
                            var tagUnit1 = this.querySelector('#tagUnit1').value;
                            tagsData.push({
                                'tag_name': tagSelected1.tag_name,
                                'tag_id': tagSelected1.tag_id,
                                'max_date': tagSelected1.max_date,
                                'unit': tagUnit1
                            });
                        }
                    }


                    var tagName2 = this.querySelector('#createTileTagName2');
                    if (tagName2.value) {
                        var tagSelected2 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName2.value
                        });
                        if (tagSelected2) {
                            var tagUnit2 = this.querySelector('#tagUnit2').value;
                            tagsData.push({
                                'tag_name': tagSelected2.tag_name,
                                'tag_id': tagSelected2.tag_id,
                                'max_date': tagSelected2.max_date,
                                'unit': tagUnit2
                            });
                        }
                    }

                    var tagName3 = this.querySelector('#createTileTagName3');
                    if (tagName3.value) {
                        var tagSelected3 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName3.value
                        });
                        if (tagSelected3) {
                            var tagUnit3 = this.querySelector('#tagUnit3').value;
                            tagsData.push({
                                'tag_name': tagSelected3.tag_name,
                                'tag_id': tagSelected3.tag_id,
                                'max_date': tagSelected3.max_date,
                                'unit': tagUnit3
                            });
                        }
                    }


                    var tagName4 = this.querySelector('#createTileTagName4');
                    if (tagName4.value) {
                        var tagSelected4 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName4.value
                        });
                        if (tagSelected4) {
                            var tagUnit4 = this.querySelector('#tagUnit4').value;
                            tagsData.push({
                                'tag_name': tagSelected4.tag_name,
                                'tag_id': tagSelected4.tag_id,
                                'max_date': tagSelected4.max_date,
                                'unit': tagUnit4
                            });
                        }
                    }



                    var tagName5 = this.querySelector('#createTileTagName5');
                    if (tagName5.value) {
                        var tagSelected5 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName5.value
                        });
                        if (tagSelected5) {
                            var tagUnit5 = this.querySelector('#tagUnit4').value;
                            tagsData.push({
                                'tag_name': tagSelected5.tag_name,
                                'tag_id': tagSelected5.tag_id,
                                'max_date': tagSelected5.max_date,
                                'unit': tagUnit5
                            });
                        }
                    }

                    createChartData = {
                        'dashboard_id': this.dashboardId,
                        'tile_type': this.chartType,
                        'description': null,
                        'sort_id': itemSortId,
                        'tile_config': {
                            'tileTitle': createTileTitle,
                            'tags': tagsData
                        }
                    }
                }






                var addMultiDashboardTile = this.querySelector('#addMultiDashboardTile');
                addMultiDashboardTile.body = createChartData;
                addMultiDashboardTile.generateRequest();

            },

            _onResponse_addMultiDashboardTile: function (e) {
                // console.log('_onResponse_addMultiDashboardTile', e.detail.response);
                if (e.detail.response && e.detail.response.status) {
                    this.createDashboardTileStatus = e.detail.response.status;
                }
            },

            _closeModal_createTile: function (e) {
                // console.log('_closeModalCreateDashboard', e);
                if (this.createDashboardTileStatus) {
                    // this.querySelector('#getMultiDashboardTiles').generateRequest();
                    document.querySelector('#getMultiDashboard').generateRequest();
                }
            },
            /*createTile - END*/











            /*editDashboardTile - START*/
            _editDashboardTile: function (e) {
                e.preventDefault();

                this.editDashboardTileStatus = null;

                if (this.querySelector('#form_editTile' + this.tabUid)) {
                    this.querySelector('#form_editTile' + this.tabUid).reset();
                }

                var editDashboardTileData = this.editDashboardTileData = JSON.parse(e.currentTarget.dataset.graph);
                // console.log('editDashboardTileData', this.editDashboardTileData);
            },

            _submit_editTile: function (e) {
                e.preventDefault();
                // console.log('_submit_editTile', e.currentTarget.dataset.formType);


                // this.editDashboardTileStatus = null;

                var tagSelected = this.editDashboardTileData;


                var updateMultiDashboardTile = this.querySelector('#updateMultiDashboardTile');

                var editChartData = new FormData();






                if (tagSelected.tile_type === 'kpi') {

                    var tagsData = [];

                    var tagName1 = this.querySelector('#createTileTagName1');
                    if (tagName1 && tagName1.value) {
                        var tagSelected1 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName1.value
                        });
                        if (tagSelected1) {
                            var tagUnit1 = this.querySelector('#tagUnit1').value;
                            tagsData.push({
                                'tag_name': tagSelected1.tag_name,
                                'tag_id': tagSelected1.tag_id,
                                'max_date': tagSelected1.max_date,
                                'unit': tagUnit1
                            });
                        }
                    }


                    var tagName2 = this.querySelector('#createTileTagName2');
                    if (tagName2 && tagName2.value) {
                        var tagSelected2 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName2.value
                        });
                        if (tagSelected2) {
                            var tagUnit2 = this.querySelector('#tagUnit2').value;
                            tagsData.push({
                                'tag_name': tagSelected2.tag_name,
                                'tag_id': tagSelected2.tag_id,
                                'max_date': tagSelected2.max_date,
                                'unit': tagUnit2
                            });
                        }
                    }

                    var tagName3 = this.querySelector('#createTileTagName3');
                    if (tagName3 && tagName3.value) {
                        var tagSelected3 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName3.value
                        });
                        if (tagSelected3) {
                            var tagUnit3 = this.querySelector('#tagUnit3').value;
                            tagsData.push({
                                'tag_name': tagSelected3.tag_name,
                                'tag_id': tagSelected3.tag_id,
                                'max_date': tagSelected3.max_date,
                                'unit': tagUnit3
                            });
                        }
                    }


                    var tagName4 = this.querySelector('#createTileTagName4');
                    if (tagName4 && tagName4.value) {
                        var tagSelected4 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName4.value
                        });
                        if (tagSelected4) {
                            var tagUnit4 = this.querySelector('#tagUnit4').value;
                            tagsData.push({
                                'tag_name': tagSelected4.tag_name,
                                'tag_id': tagSelected4.tag_id,
                                'max_date': tagSelected4.max_date,
                                'unit': tagUnit4
                            });
                        }
                    }



                    editChartData = {
                        'tile_id': tagSelected.tile_id,
                        'dashboard_id': this.dashboardId,
                        'tile_type': tagSelected.tile_type,
                        'description': null,
                        'sort_id': tagSelected.sort_id,
                        'tile_config': {
                            'tags': tagsData
                        }
                    }

                }







                if (tagSelected.tile_type === 'lineChart') {

                    var tagName = this.querySelector('#createTileTagName').value;
                    var tagSelected1 = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName
                    });


                    if (!tagSelected1) {
                        this.editDashboardTileStatus = 'Please select a tag';
                        return;
                    }

                    var tagUnit = this.querySelector('#tagUnit').value || null;
                    var graphPeriod = parseInt(this.querySelector('#graphPeriod').value);
                    var optimumValue = this.querySelector('#optimumValue').value || null;
                    var alarmMinValue = this.querySelector('#alarmMinValue').value || null;
                    var alarmMaxValue = this.querySelector('#alarmMaxValue').value || null;
                    var currentValue = this.querySelector('#currentValue').checked;




                    editChartData = {
                        'tile_id': tagSelected.tile_id,
                        'dashboard_id': this.dashboardId,
                        'tile_type': tagSelected.tile_type,
                        'description': null,
                        'sort_id': tagSelected.sort_id,
                        'tile_config': {
                            'tag_name': tagSelected1.tag_name,
                            'tag_id': tagSelected1.tag_id,
                            'max_date': tagSelected1.max_date,
                            'unit': tagUnit,
                            'graph_period': graphPeriod,
                            'optimum_value': optimumValue,
                            'alarm_min_value': alarmMinValue,
                            'alarm_max_value': alarmMaxValue,
                            'current_value': currentValue
                        }
                    }

                }










                if (tagSelected.tile_type === 'compareChart') {
                    var tagName1 = this.querySelector('#createTileTagName1').value;
                    var tagSelected1 = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName1
                    });
                    var tagUnit1 = this.querySelector('#tagUnit1').value || null;
                    if (!tagSelected1) {
                        this.editDashboardTileStatus = 'Please select tag 1';
                        return;
                    }


                    var tagName2 = this.querySelector('#createTileTagName2').value;
                    var tagSelected2 = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName2
                    });
                    var tagUnit2 = this.querySelector('#tagUnit2').value || null;
                    if (!tagSelected1) {
                        this.editDashboardTileStatus = 'Please select tag 1';
                        return;
                    }


                    var graphPeriod = parseInt(this.querySelector('#graphPeriod').value);
                    var optimumValue = this.querySelector('#optimumValue').value || null;
                    var alarmMinValue = this.querySelector('#alarmMinValue').value || null;
                    var alarmMaxValue = this.querySelector('#alarmMaxValue').value || null;

                    editChartData = {
                        'tile_id': tagSelected.tile_id,
                        'dashboard_id': this.dashboardId,
                        'tile_type': tagSelected.tile_type,
                        'description': null,
                        'sort_id': tagSelected.sort_id,
                        'tile_config': {
                            'tag_name1': tagSelected1.tag_name,
                            'tag_id1': tagSelected1.tag_id,
                            'max_date1': tagSelected1.max_date,
                            'unit1': tagUnit1,

                            'tag_name2': tagSelected2.tag_name,
                            'tag_id2': tagSelected2.tag_id,
                            'max_date2': tagSelected2.max_date,
                            'unit2': tagUnit2,

                            'graph_period': graphPeriod,
                            'optimum_value': optimumValue,
                            'alarm_min_value': alarmMinValue,
                            'alarm_max_value': alarmMaxValue
                        }
                    }
                }









                if (tagSelected.tile_type === 'gaugeChart') {
                    var tagName = this.querySelector('#createTileTagName').value;
                    var tagSelected1 = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName
                    });

                    if (!tagSelected1) {
                        this.editDashboardTileStatus = 'Please select a tag';
                        return;
                    }

                    var tagUnit = this.querySelector('#tagUnit').value || null;
                    var alarmMinValue = this.querySelector('#alarmMinValue').value || null;
                    var alarmMaxValue = this.querySelector('#alarmMaxValue').value || null;

                    editChartData = {
                        'tile_id': tagSelected.tile_id,
                        'dashboard_id': this.dashboardId,
                        'tile_type': tagSelected.tile_type,
                        'description': null,
                        'sort_id': tagSelected.sort_id,
                        'tile_config': {
                            'tag_name': tagSelected1.tag_name,
                            'tag_id': tagSelected1.tag_id,
                            'max_date': tagSelected1.max_date,
                            'unit': tagUnit,
                            'min_value': alarmMinValue,
                            'max_value': alarmMaxValue
                        }
                    }
                }










                if (tagSelected.tile_type === 'slider') {
                    var _root = this;


                    var sliderDefinedThresholdValues = [];
                    _root.editDashboardTileData.tile_config.thresholds.forEach(function (item, index) {
                        var thresholdFrom = _root.querySelector('#_from' + _root._replaceDot(item.from)).value;
                        var thresholdTo = _root.querySelector('#_to' + _root._replaceDot(item.to)).value;
                        var thresholdColor = _root.querySelector('#_color' + _root._replaceDot(item.color)).value;
                        if (thresholdFrom && thresholdTo && thresholdColor) {
                            sliderDefinedThresholdValues.push({
                                'from': thresholdFrom,
                                'to': thresholdTo,
                                'color': thresholdColor
                            });
                        }
                    });
                    // console.log('sliderDefinedThresholdValues', sliderDefinedThresholdValues);


                    var sliderThresholdValues = [];
                    _root.sliderThresholds.forEach(function (item, index) {
                        var thresholdFrom = _root.querySelector('#' + item.from).value;
                        var thresholdTo = _root.querySelector('#' + item.to).value;
                        var thresholdColor = _root.querySelector('#' + item.color).value;
                        if (thresholdFrom && thresholdTo && thresholdColor) {
                            sliderThresholdValues.push({
                                'from': thresholdFrom,
                                'to': thresholdTo,
                                'color': thresholdColor
                            });
                        }
                    });
                    // console.log('sliderThresholdValues', sliderThresholdValues);



                    var tagName = this.querySelector('#createTileTagName').value;
                    var tagSelected1 = this.responseTagList.find(function (e) {
                        return e.tag_name === tagName
                    });
                    if (!tagSelected1) {
                        this.editDashboardTileStatus = 'Please select a tag';
                        return;
                    }

                    var tagUnit = this.querySelector('#tagUnit').value || null;
                    var tagTarget = this.querySelector('#tagTarget').value || null;
                    // var alarmMinValue = this.querySelector('#alarmMinValue').value || null;
                    // var alarmMaxValue = this.querySelector('#alarmMaxValue').value || null;

                    editChartData = {
                        'tile_id': tagSelected.tile_id,
                        'dashboard_id': this.dashboardId,
                        'tile_type': tagSelected.tile_type,
                        'description': null,
                        'sort_id': tagSelected.sort_id,
                        'tile_config': {
                            'tag_name': tagSelected1.tag_name,
                            'tag_id': tagSelected1.tag_id,
                            'max_date': tagSelected1.max_date,
                            'unit': tagUnit,
                            'thresholds': sliderDefinedThresholdValues.concat(sliderThresholdValues),
                            'tag_target': tagTarget
                        }
                    }
                }










                if (tagSelected.tile_type === 'table') {

                    var tagsData = [];

                    var createTileTitle = this.querySelector('#createTileTitle').value || null;
                    console.log('createTileTitle', createTileTitle)
                    if (!createTileTitle) {
                        this.editDashboardTileStatus = 'Please provide a title';
                        return;
                    }

                    var tagName1 = this.querySelector('#createTileTagName1');
                    if (tagName1 && tagName1.value) {
                        var tagSelected1 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName1.value
                        });
                        if (tagSelected1) {
                            var tagUnit1 = this.querySelector('#tagUnit1').value;
                            tagsData.push({
                                'tag_name': tagSelected1.tag_name,
                                'tag_id': tagSelected1.tag_id,
                                'max_date': tagSelected1.max_date,
                                'unit': tagUnit1
                            });
                        }
                    }


                    var tagName2 = this.querySelector('#createTileTagName2');
                    if (tagName2 && tagName2.value) {
                        var tagSelected2 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName2.value
                        });
                        if (tagSelected2) {
                            var tagUnit2 = this.querySelector('#tagUnit2').value;
                            tagsData.push({
                                'tag_name': tagSelected2.tag_name,
                                'tag_id': tagSelected2.tag_id,
                                'max_date': tagSelected2.max_date,
                                'unit': tagUnit2
                            });
                        }
                    }

                    var tagName3 = this.querySelector('#createTileTagName3');
                    if (tagName3 && tagName3.value) {
                        var tagSelected3 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName3.value
                        });
                        if (tagSelected3) {
                            var tagUnit3 = this.querySelector('#tagUnit3').value;
                            tagsData.push({
                                'tag_name': tagSelected3.tag_name,
                                'tag_id': tagSelected3.tag_id,
                                'max_date': tagSelected3.max_date,
                                'unit': tagUnit3
                            });
                        }
                    }


                    var tagName4 = this.querySelector('#createTileTagName4');
                    if (tagName4 && tagName4.value) {
                        var tagSelected4 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName4.value
                        });
                        if (tagSelected4) {
                            var tagUnit4 = this.querySelector('#tagUnit4').value;
                            tagsData.push({
                                'tag_name': tagSelected4.tag_name,
                                'tag_id': tagSelected4.tag_id,
                                'max_date': tagSelected4.max_date,
                                'unit': tagUnit4
                            });
                        }
                    }


                    var tagName5 = this.querySelector('#createTileTagName5');
                    if (tagName5 && tagName5.value) {
                        var tagSelected5 = this.responseTagList.find(function (e) {
                            return e.tag_name === tagName5.value
                        });
                        if (tagSelected5) {
                            var tagUnit5 = this.querySelector('#tagUnit5').value;
                            tagsData.push({
                                'tag_name': tagSelected5.tag_name,
                                'tag_id': tagSelected5.tag_id,
                                'max_date': tagSelected5.max_date,
                                'unit': tagUnit5
                            });
                        }
                    }



                    editChartData = {
                        'tile_id': tagSelected.tile_id,
                        'dashboard_id': this.dashboardId,
                        'tile_type': tagSelected.tile_type,
                        'description': null,
                        'sort_id': tagSelected.sort_id,
                        'tile_config': {
                            'tileTitle': createTileTitle,
                            'tags': tagsData
                        }
                    }

                }







                // console.log('editChartData', editChartData);

                updateMultiDashboardTile.body = editChartData;
                updateMultiDashboardTile.generateRequest();
            },

            _onResponse_updateMultiDashboardTile: function (e) {
                // console.log('_onResponse_updateMultiDashboardTile', e.detail.response);
                if (e.detail.response && e.detail.response.status) {
                    this.editDashboardTileStatus = e.detail.response.status;
                }
            },

            _closeModal_editTile: function (e) {
                // console.log('_closeModal_editTile', e);
                this.sliderThresholds = [];
                if (this.editDashboardTileStatus) {
                    // window.stop();
                    // this.querySelector('#getMultiDashboardTiles').generateRequest();
                    document.querySelector('#getMultiDashboard').generateRequest();
                }
            },
            /*editDashboardTile - END*/











            /*deleteDashboardTile - START*/
            _deleteDashboardTile: function (e) {
                // e.preventDefault();
                this.deleteDashboardTileStatus = null;

                var deleteDashboardTileData = this.deleteDashboardTileData = JSON.parse(e.currentTarget.dataset.graph);
                // console.log('deleteDashboardTileData', this.deleteDashboardTileData);
            },

            _submit_deleteMultiDashboardTile: function (e) {
                e.preventDefault();
                var deleteMultiDashboardTile = this.querySelector('#deleteMultiDashboardTile');
                deleteMultiDashboardTile.url = '/deleteMultiDashboardTile/' + this.deleteDashboardTileData.tile_id;
                deleteMultiDashboardTile.generateRequest();
            },

            _onResponse_deleteMultiDashboardTile: function (e) {
                if (e.detail.response && e.detail.response.status) {
                    this.deleteDashboardTileStatus = e.detail.response.status;
                }
            },

            _closeModal_deleteMultiDashboardTile: function (e) {
                // console.log('_closeModalCreateDashboard', e);
                if (this.deleteDashboardTileStatus) {
                    // window.stop();
                    // this.querySelector('#getMultiDashboardTiles').generateRequest();
                    document.querySelector('#getMultiDashboard').generateRequest();
                }
            }
            /*deleteDashboardTile - END*/


        });
    </script>

</dom-module>