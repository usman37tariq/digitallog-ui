<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html" />
<link rel="import" href="../../bower_components/global-var/global-var.html">
<dom-module id="checklist-builder-list">

    <template>

        <style>
            :host {
                display: block;
                width: 100%;
            }

            .list-group-item.active {
                background-color: #e9ecef;
                border-color: #dee2e6;
                color: #495057;
            }

            /* .item-actions{
                display: none;
            }

            .list-group-item:hover .item-actions{
                display: block;
            } */

            .list-group-item.active .text-black-50 {
                color: rgba(255, 255, 255, .75) !important;
            }


            .list.constrained.detail-active {
                display: none !important;
            }

            .detail.list-active {
                display: none !important;
            }

            .back-link {
                display: none !important;
            }

            .detail.constrained .back-link {
                display: block !important
            }

            .detail.constrained.list-active {
                display: none !important;
            }

            ::content .detail.constrained .detail-container {
                height: auto !important;
            }

            .detail {
                /* width: calc(100% - 25% - 64px); */
            }

            .fa-bell {
                font-size: 18px;
            }

            ::content .filters-container {
                overflow-y: auto;
                background: #dee2e6;
            }

            #sortBy,
            #sortIcon {
                cursor: pointer;
            }

            .new-template {
                display: none;
            }

            .new-template.new-template-active {
                display: block;
            }

            .text-break {
                word-break: break-word !important;
            }

            .text-detail {
                font-size: 11px;
                ;
            }
        </style>

        <global-loader>
            <iron-ajax auto id="_departmentList" url="/department" method="GET"
                last-response="{{_response_departmentList}}" on-response="_onResponse_departmentList">
            </iron-ajax>
        </global-loader>


        <global-loader>
            <iron-ajax id="_departmentSectionsItems" url$="/department/sections/{{selectedDepartment}}" method="GET"
                last-response="{{_response_departmentSectionsItems}}" loading="{{_loading_departmentSectionsItems}}"
                on-response="_onResponse_departmentSectionsItems">
            </iron-ajax>
        </global-loader>


        <global-loader>
            <iron-ajax id="addNewChecklist" method="POST" url="/checklist" content-type="application/json"
                on-response="_onResponse_addNewChecklist">
            </iron-ajax>
        </global-loader>


        <global-loader>
            <iron-ajax id="editChecklist" method="PUT" url="/checklist" content-type="application/json"
                on-response="_onResponse_editChecklist">
            </iron-ajax>
        </global-loader>


        <global-loader>
            <iron-ajax id="deleteChecklist" method="DELETE" url="/checklist" on-response="_onResponse_deleteChecklist">
            </iron-ajax>
        </global-loader>


        <div class="d-flex h-100">

            <aside id="list"
                class="list bg-light border-right col-12 col-lg-4 col-xl-3 flex-column left-container overflow-hidden d-flex">


                <div class="border-bottom mx-n3 pb-3 pt-3 px-3 w-auto flex-grow-0">
                    <div class="d-flex">
                        <div class="flex-grow-1 font-weight-normal h5 m-0">Checklist Builder</div>
                        <button on-click="_addNewChecklist" class="flex-grow-0 btn btn-dark btn-sm my-n1"
                            title="Add checklist"><i class="fas fa-plus mr-1"></i> Add checklist</button>
                    </div>


                    <div class="input-group mt-3">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="listSearch"><i class="fas fa-search"></i></label>
                        </div>
                        <input type="search" id="listSearch" class="form-control" placeholder="Type a keyword to filter"
                            value="{{_query::input}}">
                    </div>


                    <div class="d-flex">
                        <div class="bg-white border col d-flex form-group m-0 mr-1 mt-2 p-0 rounded text-black-50">
                            <label for="_department_addUser" class="col-form-label form-control-sm pr-1">Department:
                            </label>
                            <div class="flex-grow-1">
                                <select class="form-control form-control-plaintext text-black-50 form-control-sm"
                                    id="_department_addUser" on-change="_selectedDepartment"
                                    value="{{_queryDepartment::input}}">
                                    <option selected value="*">All</option>
                                    <template is="dom-repeat" items="{{_response_departmentList}}">
                                        <option value="{{item.id}}">{{item.name}}</option>
                                    </template>
                                </select>
                            </div>
                        </div>


                        <div class="bg-white border col d-flex form-group m-0 ml-1 mt-2 p-0 rounded text-black-50">
                            <label for="_section_addUser" class="col-form-label form-control-sm pr-1">Section: </label>
                            <div class="flex-grow-1">
                                <select class="form-control form-control-plaintext text-black-50 form-control-sm"
                                    id="_section_addUser" value="{{_querySection::input}}">
                                    <option selected value="*">All</option>
                                    <template is="dom-if" if="{{selectedDepartment}}" restamp>
                                        <template is="dom-repeat" items="{{_response_departmentSectionsItems}}">
                                            <option value="{{item.sectionId}}">{{item.sectionName}}</option>
                                        </template>
                                    </template>
                                </select>
                            </div>
                        </div>
                    </div>


                    <div class="bg-white border d-flex form-group m-0 mt-2 rounded text-black-50">
                        <label for="sortBy" class="col-form-label form-control-sm pr-1">Sort by: </label>
                        <div class="flex-grow-1">
                            <select class="form-control form-control-plaintext text-black-50 form-control-sm"
                                id="sortBy" on-change="_sortByChange">
                                <option value="name">Name</option>
                                <option value="department_name">Department</option>
                                <option value="section_name">Section</option>
                            </select>
                        </div>
                        <div class="ml-1 col-form-label form-control-sm" on-click="_reverseSort">
                            <i id="sortIcon" class="fas fa-arrow-down" title="Descending"></i>
                        </div>
                    </div>










                </div>




                <div class="list-container position-sticky mx-n3 overflow-auto h-100">
                    <ul id="list__body" class="list-group list-group-flush" on-scroll="_updateClass">
                        <template is="dom-repeat" items="{{listItems}}" as="listItem"
                            filter="{{_computeFilter(_query, _queryDepartment, _querySection)}}"
                            sort="{{_computeSort(sortBy,sortOrder)}}">
                            <li id="{{listItem.id}}" data-listid$="{{listItem.id}}"
                                class$="list-group-item list-group-item-action pointer {{_computeClass(selectedItem,listItem.id)}}"
                                on-click="_selectItem">

                                <div class="d-flex">
                                    <div class="col-10 p-0">
                                        <div class="m-0 text-break" title="{{listItem.name}}">{{listItem.name}}</div>
                                        <div class="text-muted text-break text-detail"
                                            title="Department: {{listItem.section.department.name}}">
                                            Department: {{listItem.section.department.name}}</div>
                                        <div class="text-muted text-break text-detail"
                                            title="Section: {{listItem.section.sectionName}}">
                                            Section: {{listItem.section.sectionName}}
                                        </div>
                                    </div>
                                    <div class="align-items-center col-2 d-flex item-actions justify-content-end p-0">
                                        <button data-listid$="{{listItem.id}}" on-click="_editChecklist"
                                            class="btn btn-outline-dark btn-sm mt-n1 border-0" title="Edit checklist"><i
                                                class="fas fa-sm fa-pen"></i></button>
                                        <button data-listid$="{{listItem.id}}" on-click="_deleteChecklist"
                                            class="btn btn-outline-danger btn-sm mt-n1 border-0"
                                            title="Delete checklist"><i class="fas fa-sm fa-trash"></i></button>
                                    </div>
                                </div>

                            </li>
                        </template>
                    </ul>
                </div>

            </aside>


            <div id="detail" class="detail p-0 flex-grow-1 overflow-auto d-flex flex-column">
                <div class="flex-grow-0">
                    <div class="back-link">
                        <span class="btn btn-sm ml-3 my-2" on-click="_goBackToList"><i
                                class="fas fa-arrow-left mr-2"></i>Back</span>
                    </div>
                </div>
                <div class="flex-grow-1 overflow-auto">
                    <content></content>
                </div>
            </div>


            <!-- Modal - addNewChecklist -->
            <div class="modal" id="_modal_addNewChecklist" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Add checklist</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                                on-click="_close_addNewChecklist">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>


                        <form id="_form_addNewChecklist">
                            <div class="modal-body">
                                <div class="form-group">
                                    <label for="_name_addNewChecklist" class="text-muted m-0">Name <span
                                            class="text-danger">*</span></label>
                                    <input maxlength="100" type="text" class="form-control" id="_name_addNewChecklist"
                                        pattern="^$|^[^\s]+(\s+[^\s]+)*$"
                                        title="Not allowed whitespace at begining/end of name" required>
                                </div>

                                <div class="form-group">
                                    <label for="_description_addNewChecklist" class="text-muted m-0">Description</label>
                                    <input maxlength="100" type="text" class="form-control"
                                        id="_description_addNewChecklist">
                                </div>

                                <div class="form-group">
                                    <label for="_department_addNewChecklist" class="text-muted m-0">Department <span
                                            class="text-danger">*</span></label>
                                    <select class="form-control" id="_department_addNewChecklist"
                                        on-change="_selectedDepartment" required>
                                        <option disabled selected></option>
                                        <template is="dom-repeat" items="{{_response_departmentList}}">
                                            <option value="{{item.id}}">{{item.name}}</option>
                                        </template>
                                    </select>
                                </div>


                                <div class="form-group">
                                    <label for="_section_addNewChecklist" class="text-muted m-0">Section <span
                                            class="text-danger">*</span></label>
                                    <select class="form-control" id="_section_addNewChecklist" required>
                                        <option disabled selected></option>
                                        <template is="dom-if" if="{{selectedDepartment}}" restamp>
                                            <template is="dom-repeat" items="{{_response_departmentSectionsItems}}">
                                                <option value="{{item.sectionId}}">{{item.sectionName}}</option>
                                            </template>
                                        </template>
                                    </select>
                                </div>


                            </div>



                            <div class="modal-footer flex-column align-items-stretch">
                                <div>
                                    <template is="dom-if" if="{{_status_addNewChecklist}}">
                                        <div class="alert alert-danger border-0 m-0 p-2 mb-3 text-center" role="alert">
                                            {{_status_addNewChecklist}}
                                        </div>
                                    </template>
                                </div>
                                <div class="text-right">
                                    <button type="button" class="btn btn-light" data-dismiss="modal"
                                        on-click="_cancel_addNewChecklist">Cancel</button>
                                    <button type="submit" class="btn btn-dark" on-click="_confirm_addNewChecklist"><i
                                            class="fas fa-plus mr-1"></i> Add</button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>







            <!-- Modal - editChecklist -->
            <div class="modal" id="_modal_editChecklist" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit checklist</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                                on-click="_close_editChecklist">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>


                        <form id="_form_editChecklist">
                            <div class="modal-body">
                                <div class="form-group">
                                    <label for="_name_editChecklist" class="text-muted m-0">Name <span
                                            class="text-danger">*</span></label>
                                    <input maxlength="100" type="text" class="form-control" id="_name_editChecklist"
                                        value="{{selectedListItem.name}}" pattern="^$|^[^\s]+(\s+[^\s]+)*$"
                                        title="Not allowed whitespace at begining/end of name" required>

                                </div>

                                <div class="form-group">
                                    <label for="_description_editChecklist" class="text-muted m-0">Description</label>
                                    <input maxlength="100" type="text" class="form-control"
                                        id="_description_editChecklist" value="{{selectedListItem.description}}">
                                </div>

                                <div class="form-group">
                                    <label for="_department_editChecklist" class="text-muted m-0">Department <span
                                            class="text-danger">*</span></label>
                                    <select class="form-control" id="_department_editChecklist"
                                        on-change="_selectedDepartment" required>
                                        <option disabled selected></option>
                                        <template is="dom-repeat" items="{{_response_departmentList}}">
                                            <option value$="{{item.id}}"
                                                selected="{{_isEqual(item.id, selectedListItem.section.department.id)}}">
                                                {{item.name}}</option>
                                        </template>
                                    </select>
                                </div>


                                <div class="form-group">
                                    <label for="_section_editChecklist" class="text-muted m-0">Section <span
                                            class="text-danger">*</span></label>
                                    <select class="form-control" id="_section_editChecklist" required>
                                        <option disabled selected></option>
                                        <template is="dom-if" if="{{selectedDepartment}}" restamp>
                                            <template is="dom-repeat" items="{{_response_departmentSectionsItems}}">
                                                <option value$="{{item.sectionId}}"
                                                    selected="{{_isEqual(item.sectionId, selectedListItem.section.sectionId)}}">
                                                    {{item.sectionName}}</option>
                                            </template>
                                        </template>
                                    </select>
                                </div>
                            </div>


                            <div class="modal-footer flex-column align-items-stretch">
                                <div>
                                    <template is="dom-if" if="{{_status_editChecklist}}">
                                        <div class="alert alert-danger border-0 m-0 p-2 mb-3 text-center" role="alert">
                                            {{_status_editChecklist}}
                                        </div>
                                    </template>
                                </div>
                                <div class="text-right">
                                    <button type="button" class="btn btn-light" data-dismiss="modal"
                                        on-click="_cancel_editChecklist">Cancel</button>
                                    <button type="submit" class="btn btn-dark" on-click="_confirm_editChecklist"><i
                                            class="fas fa-save mr-1"></i> Save</button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>







            <!-- Modal - deleteChecklist -->
            <div class="modal" id="_modal_deleteChecklist" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Delete checklist</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                                on-click="_close_deleteChecklist">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>


                        <div class="modal-body">
                            Are you sure, you want to delete?
                        </div>

                        <div class="modal-footer align-items-stretch">
                            <div class="flex-grow-0">
                                <button type="button" class="btn btn-light" data-dismiss="modal"
                                    on-click="_cancel_deleteChecklist">Cancel</button>
                                <button class="btn btn-danger" on-click="_confirm_deleteChecklist"><i
                                        class="fas fa-trash mr-1"></i> Delete</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>



        </div>
    </template>

    <script>
        Polymer({
            is: "checklist-builder-list",

            behaviors: [
                Polymer.IronResizableBehavior
            ],

            listeners: {
                "iron-resize": "_calculateBounds"
            },

            properties: {
                /**
                 * Array of items to include in the list. Each item in the array should be an object with:
                 * - id (used for fetching the details view)
                 * - title
                 * - subtitle
                 * - severity (one of "important", "error", "warning", or "information")
                 * - date (optional, should be valid <a href="https://www.w3.org/TR/NOTE-datetime">8601 date strings</a>)
                 */
                listItems: {
                    type: Array,
                    notify: true
                },
                /**
                 * ID of the selected item, for pulling up the details to display in the right side of the inbox view.
                 */
                selectedItem: {
                    type: String,
                    notify: true
                },
                /**
                 * Search query used to filter the list.
                 */
                _query: {
                    type: String,
                    value: ''
                },
                /**
                 * Property to sort the list by.
                 */
                sortBy: {
                    type: String,
                    value: "name"
                },
                /**
                 * Sort order - ascending or descending.
                 */
                sortOrder: {
                    type: String,
                    value: "ascending"
                },
                /**
                 * By default, the first item in the list will be selected.
                 * Set this flag to "true" to disable this default selection.
                 */
                disableAutoSelect: {
                    type: Boolean,
                    value: false
                },

                _queryDepartment: {
                    value: '*'
                },

                _querySection: {
                    value: '*'
                }

            },

            created: function () {
                document.documentElement.classList.remove('in-progress');
            },

            ready: function () {

            },

            attached: function () { },

            detached: function () { },

            attributeChanged: function (name, type) {

            },

            /**
             * Figures out whether the item is currently selected.
             */
            _computeClass: function (selectedId, id) {
                return (selectedId && String(selectedId) === String(id)) ? 'active' : '';
            },

            /**
             * Adds visual style to the currently selected item and triggers display of the details.
             */
            _selectItem: function (evt) {
                root = this;
                // var seclectedTagId = evt.currentTarget.id;
                var seclectedTagId = evt.currentTarget.dataset.listid;

                // var otherItems = Polymer.dom(this.root).querySelectorAll('.active');
                // for (var i = 0; i < otherItems.length; i++) {
                //     // otherItems[i].classList.remove("active");
                // };
                // document.getElementById(seclectedTagId).classList.add("active");
                this.selectedItem = document.getElementById(seclectedTagId).id;

                this.toggleClass('detail-active', true, this.$.list);
                this.toggleClass('list-active', false, this.$.detail);

            },
            /**
             * When the window or any parent container is resized, need to recalculate the bounds
             * of the px-inbox and react accordingly - in constrained situations, the list and detail
             * will not be displayed simultaneously but will toggle back and forth instead.
             */
            _calculateBounds: function (evt) {
                this.debounce('resize', function () {
                    if (this.getBoundingClientRect().width < 990) {
                        this.toggleClass('constrained', true, this.$.list);
                        this.toggleClass('constrained', true, this.$.detail);

                        this.toggleClass('detail-active', false, this.$.list);
                        this.toggleClass('list-active', true, this.$.detail);

                    } else {
                        this.toggleClass('constrained', false, this.$.list);
                        this.toggleClass('constrained', false, this.$.detail);

                        this.toggleClass('detail-active', true, this.$.list);
                        this.toggleClass('list-active', false, this.$.detail);
                    }
                }, 300);
            },
            /**
             * For small form factors, these classes are toggled in order to toggle back and forth
             * between the list and detail views.
             */
            _goBackToList: function (evt) {
                this.toggleClass('detail-active', false, this.$.list);
                this.toggleClass('list-active', true, this.$.detail);
            },
            /**
             * Searches through the list titles and subtitles and filters based on the query.
             */
            _computeFilter: function (query, queryDepartment, querySection) {
                // console.log('_computeFilter', query, queryDepartment, querySection)

                // return a filter function for the current search query
                query = query.toLowerCase();
                return function (listItem) {
                    var name = listItem.name.toLowerCase();
                    var department = listItem.section.department.name.toLowerCase();
                    var departmentId = listItem.section.department.id.toString();
                    //  console.log('departmentId', departmentId, queryDepartment, queryDepartment === departmentId);

                    var section = listItem.section.sectionName.toLowerCase();
                    var sectionId = listItem.section.sectionId.toString();
                    // console.log('sectionId', sectionId, querySection, querySection === sectionId);


                    if (query !== '' && queryDepartment !== '*' && querySection !== '*') {
                        // console.log('1')
                        return (name.indexOf(query) !== -1 && departmentId === queryDepartment && querySection === sectionId);
                    } else if (queryDepartment !== '*' && querySection !== '*') {
                        // console.log('2')
                        return (departmentId === queryDepartment && querySection === sectionId);
                    } else if (queryDepartment !== '*') {
                        if (query !== '') {
                            // console.log('3a')
                            return (name.indexOf(query) !== -1 && departmentId === queryDepartment)
                        }
                        // console.log('3')
                        return (departmentId === queryDepartment);
                    } else if (query !== '') {
                        // console.log('4')
                        return (name.indexOf(query) !== -1)
                    } else {
                        // console.log('5')
                        return true
                    }
                };
            },
            _computeSort: function (sortBy, sortOrder) {
                var _root = this;
                sortBy = sortBy ? sortBy.toLowerCase().replace(/\s+/g, '') : '';
                var asc = sortOrder === 'ascending';
                // return sort function which maps severities to numeric values
                if (asc) {
                    return function (a, b) {
                        return (a[sortBy] < b[sortBy]) ? -1 : (a[sortBy] > b[sortBy]) ? 1 : 0;
                    }
                } else if (!asc) {
                    return function (b, a) {
                        return (a[sortBy] < b[sortBy]) ? -1 : (a[sortBy] > b[sortBy]) ? 1 : -1;
                    }
                }

            },
            _reverseSort: function () {
                if (this.sortOrder === 'ascending') {
                    this.sortOrder = 'descending';
                    this.$.sortIcon.classList.value = 'fas fa-arrow-up';
                    this.$.sortIcon.title = 'Ascending';
                } else if (this.sortOrder === 'descending') {
                    this.sortOrder = 'ascending';
                    this.$.sortIcon.classList.value = 'fas fa-arrow-down';
                    this.$.sortIcon.title = 'Descending';
                }
            },
            _updateClass: function () {
                this.debounce('_updateClass', function () {
                    if (this.$.list__body.scrollTop > 0) {
                        this.toggleClass('shadow-component', true, Polymer.dom(this.root)
                            .querySelector('.list__header'));
                    } else {
                        this.toggleClass('shadow-component', false, Polymer.dom(this.root)
                            .querySelector('.list__header'));
                    }
                }, 50);
            },

            _sortByChange: function (e) {
                var _root = this;
                _root.set('sortBy', e.target.value.toLowerCase().replace(/\s+/g, ''))
            },

            _selectedDepartment: function (e) {
                // console.log('_selectedDepartment', e.currentTarget.value.length)
                this._querySection = '*';
                this.selectedDepartment = e.currentTarget.value;

                if (this.selectedDepartment && this.selectedDepartment !== '*') {
                    var _departmentSectionsItems = this.querySelector('#_departmentSectionsItems');
                    _departmentSectionsItems.generateRequest();
                } else {
                    this.selectedDepartment = false;
                }
            },

            _isEqual: function (str1, str2) {
                return str1 === str2
            },



            _addNewChecklist: function (e) {
                // console.log('_addNewChecklist', e);
                e.stopPropagation();

                var _form_addNewChecklist = this.querySelector('#_form_addNewChecklist');
                _form_addNewChecklist.reset();

                var selects = this.querySelectorAll('select');
                for (var i = 0; i < selects.length; i++) {
                    selects[i].selectedIndex = 0;
                }



                this._status_addNewChecklist = null;

                $(this.$._modal_addNewChecklist).modal({
                    backdrop: 'static'
                }).modal('show');

                this.querySelector('#_department_addNewChecklist').dispatchEvent(new Event('change'));
            },


            _confirm_addNewChecklist: function (e) {
                var _form_addNewChecklist = this.querySelector('#_form_addNewChecklist');

                if (_form_addNewChecklist.checkValidity()) {
                    e.preventDefault();

                    var addNewChecklist = this.querySelector('#addNewChecklist');
                    var addNewChecklistData = new FormData();

                    var _name_addNewChecklist = this.querySelector('#_name_addNewChecklist').value;
                    var _description_addNewChecklist = this.querySelector('#_description_addNewChecklist').value;
                    var _department_addNewChecklist = this.querySelector('#_department_addNewChecklist').value || 0;
                    var _section_addNewChecklist = this.querySelector('#_section_addNewChecklist').value || 0;

                    addNewChecklistData = {
                        "department": {
                            "id": _department_addNewChecklist
                        },
                        "name": _name_addNewChecklist,
                        "description": _description_addNewChecklist,
                        "section": {
                            "departmentId": _department_addNewChecklist,
                            "sectionId": _section_addNewChecklist,
                        }
                    }
                    // console.log('addNewChecklistData', addNewChecklistData);
                    addNewChecklist.body = addNewChecklistData;

                    addNewChecklist.generateRequest();
                }
            },


            _onResponse_addNewChecklist: function (e) {
                // console.log('_onResponse_addNewChecklist', e.detail.response, e.detail.response.error);
                if (e.detail.response && e.detail.response.error) {
                    this._status_addNewChecklist = e.detail.response.error;
                } else {
                    $(this.$._modal_addNewChecklist).modal('hide');
                    this._refreshList();
                }
            },
            _close_addNewChecklist: function (e) { },
            _cancel_addNewChecklist: function (e) { },








            _editChecklist: function (e) {
                // console.log('_editChecklist', e.currentTarget.dataset.listid);
                e.stopPropagation();


                var _root = this;
                var _form_editChecklist = this.querySelector('#_form_editChecklist');
                _form_editChecklist.reset();

                var seclectedId = e.currentTarget.dataset.listid;

                _root.selectedListItem = null;
                _root.async(function () {
                    for (var i = 0; i < _root.listItems.length; i++) {
                        if (_root.listItems[i].id == seclectedId) {
                            _root.selectedListItem = _root.listItems[i];
                        }
                    }
                    this.querySelector('#_department_editChecklist').dispatchEvent(new Event('change'));
                });

                this._status_editChecklist = null;

                $(this.$._modal_editChecklist).modal({
                    backdrop: 'static'
                }).modal('show');

            },


            _confirm_editChecklist: function (e) {
                // console.log('_confirm_editChecklist', e)
                var _root = this;
                var _form_editChecklist = this.querySelector('#_form_editChecklist');

                if (_form_editChecklist.checkValidity()) {
                    e.preventDefault();

                    var editChecklist = this.querySelector('#editChecklist');

                    var editChecklistData = new FormData();

                    var _name_editChecklist = this.querySelector('#_name_editChecklist').value;
                    var _description_editChecklist = this.querySelector('#_description_editChecklist').value;
                    var _department_editChecklist = this.querySelector('#_department_editChecklist').value || 0;
                    var _section_editChecklist = this.querySelector('#_section_editChecklist').value || 0;

                    editChecklistData = {
                        "checklistId": _root.selectedListItem.id,
                        "department": {
                            "id": _department_editChecklist
                        },
                        "name": _name_editChecklist,
                        "description": _description_editChecklist,
                        "section": {
                            "departmentId": _department_editChecklist,
                            "sectionId": _section_editChecklist,
                        }
                    }
                    // console.log('editChecklistData', editChecklistData);
                    editChecklist.body = editChecklistData;

                    editChecklist.generateRequest();
                }
            },

            _onResponse_editChecklist: function (e) {
                // console.log('_onResponse_editChecklist', e.detail.response);
                if (e.detail.response && e.detail.response.error) {
                    this._status_editChecklist = e.detail.response.error;
                } else {
                    $(this.$._modal_editChecklist).modal('hide');
                    this._refreshList();
                }
            },
            _close_editChecklist: function (e) { },
            _cancel_editChecklist: function (e) { },






            _deleteChecklist: function (e) {
                // console.log('_deleteChecklist', e.currentTarget.dataset.listid);
                e.stopPropagation();

                this.deleteChecklistId = e.currentTarget.dataset.listid;

                $(this.$._modal_deleteChecklist).modal({
                    backdrop: 'static'
                }).modal('show');

            },

            _confirm_deleteChecklist: function (e) {
                // console.log(this.deleteChecklistId);
                var deleteChecklist = this.querySelector('#deleteChecklist');
                deleteChecklist.url = '/checklist/' + this.deleteChecklistId;
                deleteChecklist.generateRequest();

                $(this.$._modal_deleteChecklist).modal('hide');
            },

            _onResponse_deleteChecklist: function (e) {
                // console.log('_onResponse_deleteChecklist', e.detail.response);
                this._refreshList();
            },
            _close_deleteChecklist: function (e) { },
            _cancel_deleteChecklist: function (e) { },







            _refreshList: function () {
                // this.toggleClass('detail-active', false, this.$.list);
                // this.toggleClass('list-active', true, this.$.detail);

                this.fire('refresh-list');
            },

            _onResponse_departmentList: function (e) { },

            _onResponse_departmentSectionsItems: function (e) { },

        });
    </script>

</dom-module>