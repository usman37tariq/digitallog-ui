<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="asset-management/asset-management-list.html">


<dom-module id="view-asset-management">

    <template>
        <asset-management-list list-items='{{listData}}' disable-auto-select="true"
            on-selected-item-changed="_updateDetails" sort-order="ascending">
        </asset-management-list>
        <global-loader>
            <iron-ajax auto id="getAssets" url="/getAssets" last-response="{{listData}}" on-error="_onError"
                on-response="_onResponse_getAssets"></iron-ajax>
        </global-loader>
    </template>

    <script>
        Polymer({
            is: "view-asset-management",

            properties: {
                itemData: {
                    type: Object,
                    value: function () {
                        return null
                    }
                }
            },

            created: function () {
                document.documentElement.classList.remove('in-progress');
            },

            ready: function () {


            },

            attached: function () {
            },

            detached: function () {
            },

            attributeChanged: function (name, type) {
            },

            _updateDetails: function (e) {
                var selectedItem = e.target.listItems.find(function (item) {
                    return parseInt(item.id) === parseInt(e.detail.value);
                });
                this.set("itemData", selectedItem);
            },
            _onError: function () {
                root = this;
                root.async(function () {
                    root.$.getAssets.generateRequest();
                }, 5000);
            },
            _onResponse_getAssets: function (e) {
                root = this;
                root.listData = null;
                root.listData = e.detail.response;
            }
        });
    </script>

</dom-module>